<!DOCTYPE html>
<html lang="en" data-theme="green" data-bg="mesh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ValQMS — Simplify Validation. Strengthen Quality. Accelerate Compliance.</title>
  <meta name="description" content="Validation tools and QMS Procedures.">
  <link rel="icon" href="favicon.jpg?v=5">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    
    /* Theme Colors */
    [data-theme="green"]{--accent:#10b981;--accent-bright:#34d399;--accent-dim:rgba(16,185,129,0.15);--accent-glow:rgba(16,185,129,0.4)}
    [data-theme="cyan"]{--accent:#06b6d4;--accent-bright:#22d3ee;--accent-dim:rgba(6,182,212,0.15);--accent-glow:rgba(6,182,212,0.4)}
    [data-theme="purple"]{--accent:#8b5cf6;--accent-bright:#a78bfa;--accent-dim:rgba(139,92,246,0.15);--accent-glow:rgba(139,92,246,0.4)}
    [data-theme="orange"]{--accent:#f97316;--accent-bright:#fb923c;--accent-dim:rgba(249,115,22,0.15);--accent-glow:rgba(249,115,22,0.4)}
    [data-theme="blue"]{--accent:#3b82f6;--accent-bright:#60a5fa;--accent-dim:rgba(59,130,246,0.15);--accent-glow:rgba(59,130,246,0.4)}
    [data-theme="red"]{--accent:#ef4444;--accent-bright:#f87171;--accent-dim:rgba(239,68,68,0.15);--accent-glow:rgba(239,68,68,0.4)}
    [data-theme="pink"]{--accent:#ec4899;--accent-bright:#f472b6;--accent-dim:rgba(236,72,153,0.15);--accent-glow:rgba(236,72,153,0.4)}
    [data-theme="teal"]{--accent:#14b8a6;--accent-bright:#2dd4bf;--accent-dim:rgba(20,184,166,0.15);--accent-glow:rgba(20,184,166,0.4)}
    [data-theme="indigo"]{--accent:#6366f1;--accent-bright:#818cf8;--accent-dim:rgba(99,102,241,0.15);--accent-glow:rgba(99,102,241,0.4)}
    [data-theme="yellow"]{--accent:#eab308;--accent-bright:#facc15;--accent-dim:rgba(234,179,8,0.15);--accent-glow:rgba(234,179,8,0.4)}
    [data-theme="magenta"]{--accent:#d946ef;--accent-bright:#e879f9;--accent-dim:rgba(217,70,239,0.15);--accent-glow:rgba(217,70,239,0.4)}
    [data-theme="emerald"]{--accent:#059669;--accent-bright:#10b981;--accent-dim:rgba(5,150,105,0.15);--accent-glow:rgba(5,150,105,0.4)}
    [data-theme="amber"]{--accent:#d97706;--accent-bright:#f59e0b;--accent-dim:rgba(217,119,6,0.15);--accent-glow:rgba(217,119,6,0.4)}
    [data-theme="lime"]{--accent:#84cc16;--accent-bright:#a3e635;--accent-dim:rgba(132,204,22,0.15);--accent-glow:rgba(132,204,22,0.4)}
    [data-theme="violet"]{--accent:#7c3aed;--accent-bright:#a78bfa;--accent-dim:rgba(124,58,237,0.15);--accent-glow:rgba(124,58,237,0.4)}

    :root{
      --text:#ffffff;
      --text-dim:#94a3b8;
      --surface:rgba(255,255,255,0.05);
      --surface-hover:rgba(255,255,255,0.08);
      --border:rgba(255,255,255,0.1);
      --glass:rgba(255,255,255,0.03);
    }

    /* ANIMATED BACKGROUNDS */
    [data-bg="mesh"] body{background:#0f172a;position:relative}
    [data-bg="mesh"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%, rgba(16,185,129,0.15) 0%, transparent 50%),radial-gradient(circle at 80% 80%, rgba(99,102,241,0.15) 0%, transparent 50%),radial-gradient(circle at 40% 80%, rgba(236,72,153,0.1) 0%, transparent 50%);animation:meshMove 15s ease-in-out infinite alternate;z-index:-1}

    [data-bg="gradient"] body{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);position:relative}
    [data-bg="gradient"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg, transparent 0%, rgba(0,0,0,0.3) 100%);z-index:-1}

    [data-bg="dots"] body{background:#0a0e27;position:relative}
    [data-bg="dots"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);background-size:30px 30px;z-index:-1}

    [data-bg="waves"] body{background:#0f172a;position:relative}
    [data-bg="waves"] body::before{content:'';position:fixed;bottom:0;left:0;width:100%;height:400px;background:linear-gradient(180deg, transparent 0%, rgba(16,185,129,0.1) 100%);animation:waveMove 8s ease-in-out infinite;z-index:-1}

    [data-bg="dark"] body{background:#0a0e1a;position:relative}
    [data-bg="dark"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center, rgba(59,130,246,0.05) 0%, transparent 70%);z-index:-1}

    @keyframes meshMove{0%{transform:scale(1) rotate(0deg)}100%{transform:scale(1.1) rotate(5deg)}}
    @keyframes waveMove{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}

    html{scroll-behavior:smooth}
    body{font-family:'Inter',system-ui,-apple-system,sans-serif;color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased;transition:background 0.5s ease;min-height:100vh;overflow-x:hidden}
    .container{max-width:1280px;margin:0 auto;padding:0 24px}

    /* GLASSMORPHISM HEADER */
    header{position:sticky;top:12px;z-index:1000;padding:0 24px;margin-bottom:20px}
    .header-glass{background:rgba(255,255,255,0.03);backdrop-filter:blur(20px) saturate(180%);-webkit-backdrop-filter:blur(20px) saturate(180%);border:1px solid rgba(255,255,255,0.1);border-radius:20px;padding:0 32px;box-shadow:0 8px 32px rgba(0,0,0,0.1),inset 0 1px 0 rgba(255,255,255,0.1)}
    header .container{display:flex;justify-content:space-between;align-items:center;height:72px;max-width:100%;padding:0}
    
    .logo{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text);font-weight:800;font-size:22px;letter-spacing:-0.7px;transition:all 0.3s}
    .logo:hover{transform:translateY(-2px)}
    .logo-mark{display:flex;align-items:center;justify-content:center;width:40px;height:40px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));border-radius:12px;box-shadow:0 4px 20px var(--accent-glow);transition:all 0.3s;position:relative}
    .logo-mark::after{content:'';position:absolute;inset:-2px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));border-radius:14px;z-index:-1;opacity:0;filter:blur(10px);transition:opacity 0.3s}
    .logo-mark:hover::after{opacity:0.7}
    .logo-mark img{width:100%;height:100%;object-fit:contain;padding:4px}

    nav{display:flex;gap:8px;align-items:center}
    nav a{color:var(--text-dim);text-decoration:none;font-size:15px;font-weight:500;padding:10px 18px;border-radius:10px;transition:all 0.3s;position:relative}
    nav a:hover{color:var(--text);background:var(--surface-hover)}
    nav a::after{content:'';position:absolute;bottom:0;left:50%;width:0;height:2px;background:var(--accent);transition:all 0.3s;transform:translateX(-50%)}
    nav a:hover::after{width:80%}

    /* Control Buttons Group */
    .header-controls{display:flex;gap:12px;align-items:center}
    
    /* Background Selector */
    .bg-selector{position:relative}
    .bg-btn{padding:10px 18px;background:var(--surface);border:1px solid var(--border);border-radius:12px;color:var(--text-dim);font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.3s}
    .bg-btn:hover{background:var(--surface-hover);border-color:var(--accent);color:var(--text)}
    .bg-dropdown{position:absolute;top:calc(100% + 12px);right:0;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:12px;display:none;min-width:200px;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:100}
    .bg-dropdown.active{display:block}
    .bg-option{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;cursor:pointer;transition:all 0.3s;font-size:14px;font-weight:500}
    .bg-option:hover{background:var(--surface-hover)}
    .bg-preview{width:32px;height:32px;border-radius:8px;border:2px solid rgba(255,255,255,0.2)}
    .bg-preview.mesh{background:radial-gradient(circle, #10b981 0%, #6366f1 100%)}
    .bg-preview.gradient{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%)}
    .bg-preview.dots{background:#0a0e27;background-image:radial-gradient(circle, rgba(255,255,255,0.2) 1px, transparent 1px);background-size:15px 15px}
    .bg-preview.waves{background:linear-gradient(180deg, #0f172a 0%, #10b981 100%)}
    .bg-preview.dark{background:#0a0e1a}

    /* Theme Selector */
    .theme-selector{position:relative}
    .theme-btn{padding:10px 18px;background:var(--surface);border:1px solid var(--border);border-radius:12px;color:var(--text-dim);font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.3s}
    .theme-btn:hover{background:var(--surface-hover);border-color:var(--accent);color:var(--text)}
    .theme-dropdown{position:absolute;top:calc(100% + 12px);right:0;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:12px;display:none;min-width:200px;max-height:400px;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:100}
    .theme-dropdown.active{display:block}
    .theme-dropdown::-webkit-scrollbar{width:6px}
    .theme-dropdown::-webkit-scrollbar-track{background:transparent}
    .theme-dropdown::-webkit-scrollbar-thumb{background:var(--accent);border-radius:10px}
    .theme-option{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;cursor:pointer;transition:all 0.3s;font-size:14px;font-weight:500}
    .theme-option:hover{background:var(--surface-hover)}
    .theme-color{width:28px;height:28px;border-radius:8px;border:2px solid rgba(255,255,255,0.2);transition:all 0.3s}
    .theme-option:hover .theme-color{transform:scale(1.1)}
    .theme-color.green{background:linear-gradient(135deg,#10b981,#34d399)}
    .theme-color.cyan{background:linear-gradient(135deg,#06b6d4,#22d3ee)}
    .theme-color.purple{background:linear-gradient(135deg,#8b5cf6,#a78bfa)}
    .theme-color.orange{background:linear-gradient(135deg,#f97316,#fb923c)}
    .theme-color.blue{background:linear-gradient(135deg,#3b82f6,#60a5fa)}
    .theme-color.red{background:linear-gradient(135deg,#ef4444,#f87171)}
    .theme-color.pink{background:linear-gradient(135deg,#ec4899,#f472b6)}
    .theme-color.teal{background:linear-gradient(135deg,#14b8a6,#2dd4bf)}
    .theme-color.indigo{background:linear-gradient(135deg,#6366f1,#818cf8)}
    .theme-color.yellow{background:linear-gradient(135deg,#eab308,#facc15)}
    .theme-color.magenta{background:linear-gradient(135deg,#d946ef,#e879f9)}
    .theme-color.emerald{background:linear-gradient(135deg,#059669,#10b981)}
    .theme-color.amber{background:linear-gradient(135deg,#d97706,#f59e0b)}
    .theme-color.lime{background:linear-gradient(135deg,#84cc16,#a3e635)}
    .theme-color.violet{background:linear-gradient(135deg,#7c3aed,#a78bfa)}

    /* Login Button */
    .btn-login{padding:10px 20px;background:var(--surface);border:1px solid var(--border);border-radius:12px;color:var(--text);font-size:14px;font-weight:600;text-decoration:none;transition:all 0.3s}
    .btn-login:hover{background:var(--accent);border-color:var(--accent);transform:translateY(-2px);box-shadow:0 4px 16px var(--accent-glow)}

/* User Menu - UPDATED TO MATCH OTHER BUTTONS */
.user-menu{position:relative;display:none}
.user-badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding:10px 18px;
  min-width:50px;
  height:40px;
  border-radius:12px;
  background:var(--surface);
  border:1px solid var(--border);
  color:var(--text);
  font-weight:700;
  font-size:14px;
  cursor:pointer;
  transition:all 0.3s;
  letter-spacing:0.5px;
}
.user-badge:hover{
  background:var(--surface-hover);
  border-color:var(--accent);
  color:var(--text);
  transform:translateY(-2px);
}


    /* User Menu - FIXED */
.user-dropdown{
  position:absolute;
  top:calc(100% + 12px);
  right:0;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(20px);
  border:1px solid var(--border);
  border-radius:16px;
  padding:8px;
  display:none;
  min-width:160px;
  z-index:2000;
  box-shadow:0 20px 60px rgba(0,0,0,0.3);
}

.user-dropdown.active{
  display:block;
}

.user-dropdown button{
  display:block;
  width:100%;
  text-align:left;
  background:transparent;
  border:none;
  border-radius:10px;
  color:var(--text);
  padding:12px 16px;
  font-size:14px;
  font-weight:500;
  cursor:pointer;
  transition:all 0.3s;
  margin-bottom:4px;
}

.user-dropdown button:hover{
  background:var(--surface-hover);
}

.user-dropdown button:last-child{
  margin-bottom:0;
}

.user-dropdown button:last-child:hover{
  background:rgba(239,68,68,0.1);
  color:#f87171;
}


    /* Mobile Menu Toggle */
    .mobile-menu-btn{display:none;background:var(--surface);border:1px solid var(--border);padding:10px;border-radius:12px;cursor:pointer;color:var(--text)}

    /* Hero Section */
    .hero{padding:140px 0 120px;text-align:center;position:relative}
    .pill{display:inline-flex;align-items:center;gap:10px;padding:8px 20px;background:var(--glass);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:999px;font-size:14px;color:var(--text-dim);margin-bottom:40px;transition:all 0.3s}
    .pill:hover{background:var(--surface-hover);border-color:var(--accent)}
    .pill-dot{width:8px;height:8px;background:var(--accent);border-radius:50%;animation:pulse 2s infinite;box-shadow:0 0 10px var(--accent-glow)}
    @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(0.9)}}
    
    h1{font-size:clamp(52px,9vw,82px);font-weight:900;letter-spacing:-3px;line-height:1.05;margin-bottom:32px;background:linear-gradient(135deg,#fff 0%,#94a3b8 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-shadow:0 0 80px var(--accent-glow)}
    .lead{font-size:21px;color:var(--text-dim);max-width:720px;margin:0 auto 48px;line-height:1.8;font-weight:300}
    .cta-group{display:flex;gap:20px;justify-content:center;flex-wrap:wrap}
    .cta{display:inline-flex;align-items:center;gap:12px;padding:16px 36px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));color:#000;text-decoration:none;border-radius:14px;font-weight:700;font-size:16px;transition:all 0.3s;box-shadow:0 8px 24px var(--accent-glow);position:relative;overflow:hidden}
    .cta::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--accent-bright),var(--accent));opacity:0;transition:opacity 0.3s}
    .cta:hover::before{opacity:1}
    .cta:hover{transform:translateY(-3px);box-shadow:0 12px 32px var(--accent-glow)}
    .cta span{position:relative;z-index:1}
    .cta-secondary{background:var(--glass);backdrop-filter:blur(10px);border:1px solid var(--border);color:var(--text)}
    .cta-secondary::before{background:var(--surface-hover)}
    .cta-secondary:hover{border-color:var(--accent)}

    /* Sections */
    section{padding:100px 0}
    .section-head{text-align:center;margin-bottom:64px}
    .section-head h2{font-size:clamp(36px,6vw,56px);font-weight:900;letter-spacing:-2px;margin-bottom:16px;color:#fff;background:linear-gradient(135deg,#fff 0%,#94a3b8 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .section-head p{font-size:19px;color:var(--text-dim);max-width:740px;margin:0 auto;line-height:1.8;font-weight:300}

    /* Tools List */
    .tools-scroll-wrapper{max-width:1100px;margin:0 auto;max-height:550px;overflow-y:auto;padding-right:12px;border-radius:20px}
    .tools-scroll-wrapper::-webkit-scrollbar{width:10px}
    .tools-scroll-wrapper::-webkit-scrollbar-track{background:var(--glass);border-radius:10px}
    .tools-scroll-wrapper::-webkit-scrollbar-thumb{background:var(--accent);border-radius:10px;border:2px solid transparent;background-clip:padding-box}
    .tools-list{display:flex;flex-direction:column;gap:16px}
    .tool-item{display:flex;align-items:center;gap:20px;background:var(--glass);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:18px;padding:20px 24px;text-decoration:none;color:inherit;transition:all 0.4s;position:relative;overflow:hidden}
    .tool-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:5px;background:linear-gradient(180deg,var(--accent),var(--accent-bright));transform:scaleY(0);transition:transform 0.4s}
    .tool-item:hover{background:var(--surface-hover);border-color:var(--accent);transform:translateX(8px);box-shadow:0 12px 40px rgba(0,0,0,0.3)}
    .tool-item:hover::before{transform:scaleY(1)}
    .tool-icon{width:56px;height:56px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0;transition:all 0.4s;box-shadow:0 8px 20px var(--accent-glow)}
    .tool-item:hover .tool-icon{transform:scale(1.1) rotate(5deg)}
    .tool-content{flex:1;min-width:0}
    .tool-content h3{font-size:18px;font-weight:700;margin-bottom:6px;color:var(--text);letter-spacing:-0.4px}
    .tool-content p{color:var(--text-dim);font-size:14px;line-height:1.6;font-weight:300}
    .tool-arrow{font-size:28px;color:var(--accent);transition:all 0.4s;flex-shrink:0}
    .tool-item:hover .tool-arrow{transform:translateX(12px) scale(1.2)}

    /* QMS Grid */
    .qms-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px}
    .module-card{background:var(--glass);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:18px;padding:32px;transition:all 0.4s;position:relative;overflow:hidden}
    .module-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:5px;background:linear-gradient(90deg,var(--accent),var(--accent-bright));transform:scaleX(0);transform-origin:left;transition:transform 0.5s ease}
    .module-card:hover{transform:translateY(-8px);border-color:var(--accent);box-shadow:0 16px 48px rgba(0,0,0,0.3)}
    .module-card:hover::before{transform:scaleX(1)}
    .module-card h4{font-size:19px;font-weight:700;margin-bottom:12px;color:var(--text);letter-spacing:-0.3px}
    .module-card p{font-size:14px;color:var(--text-dim);line-height:1.7;font-weight:300}
    .qms-cta-wrapper{text-align:center;margin-top:56px}

    /* Resources Grid */
    .resources-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:24px}
    .resource-card{background:var(--glass);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:18px;padding:32px;transition:all 0.4s}
    .resource-card:hover{border-color:var(--accent);box-shadow:0 16px 48px rgba(0,0,0,0.3);transform:translateY(-4px)}
    .resource-icon{width:56px;height:56px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:28px;margin-bottom:20px;box-shadow:0 8px 20px var(--accent-glow)}
    .resource-card h3{font-size:20px;font-weight:700;margin-bottom:16px;letter-spacing:-0.3px}
    .resource-card ul{list-style:none;padding:0;font-size:14px;line-height:2.2;font-weight:300}
    .resource-card a{color:var(--accent);text-decoration:none;font-weight:500;transition:all 0.3s}
    .resource-card a:hover{color:var(--accent-bright);padding-left:4px}

    /* MODERN MINIMAL FOOTER */
    footer{margin-top:120px;border-top:1px solid var(--border);background:var(--glass);backdrop-filter:blur(20px)}
    .footer-content{padding:56px 0 32px}
    .footer-grid{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:48px;margin-bottom:48px}
    .footer-brand{display:flex;flex-direction:column;gap:20px}
    .footer-brand .logo{font-size:24px}
    .footer-brand p{color:var(--text-dim);font-size:14px;line-height:1.8;max-width:320px;font-weight:300}
    .footer-col h5{font-size:13px;font-weight:700;margin-bottom:16px;text-transform:uppercase;letter-spacing:1px;color:var(--text)}
    .footer-col ul{list-style:none}
    .footer-col li{margin-bottom:12px}
    .footer-col a{color:var(--text-dim);text-decoration:none;font-size:14px;transition:all 0.3s;display:inline-block;font-weight:400}
    .footer-col a:hover{color:var(--accent);transform:translateX(4px)}
    .footer-bottom{padding:24px 0;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;color:var(--text-dim);font-size:13px}
    .footer-socials{display:flex;gap:16px}
    .footer-socials a{width:36px;height:36px;border-radius:10px;background:var(--surface);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;color:var(--text-dim);text-decoration:none;transition:all 0.3s}
    .footer-socials a:hover{background:var(--accent);color:#000;border-color:var(--accent);transform:translateY(-2px)}

    /* Profile Panel */
    #profilePanel{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:2000;backdrop-filter:blur(8px)}
    .profile-content{max-width:420px;margin:80px auto;background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:20px;padding:32px;box-shadow:0 12px 40px rgba(0,0,0,0.3);position:relative}
    .close-btn{position:absolute;top:12px;right:12px;background:none;border:none;color:var(--text-dim);font-size:24px;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:all 0.3s}
    .close-btn:hover{color:var(--text);transform:rotate(90deg)}
    .profile-content h2{font-size:24px;font-weight:800;margin-bottom:20px;color:var(--text)}
    .profile-content label{display:block;font-size:13px;color:var(--text-dim);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
    .profile-content input{width:100%;padding:12px 16px;border:1px solid var(--border);border-radius:12px;background:var(--surface);color:#ffffff !important;font-size:14px;margin-bottom:20px;transition:all 0.3s}
    .profile-content input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-dim)}
    .profile-content input:disabled{opacity:0.5;cursor:not-allowed}
    .btn-group{display:flex;gap:12px}
    .btn{flex:1;padding:12px 24px;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.3s}
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent-bright));color:#000;box-shadow:0 4px 16px var(--accent-glow)}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 24px var(--accent-glow)}
    .btn-secondary{background:var(--surface);border:1px solid var(--border);color:var(--text)}
    .btn-secondary:hover{background:var(--surface-hover)}
    #profileMsg{min-height:20px;color:var(--text-dim);margin-bottom:20px;font-size:14px}

    @media(max-width:968px){
      header{top:8px;padding:0 16px}
      .header-glass{padding:0 20px;border-radius:16px}
      .mobile-menu-btn{display:block}
      nav{display:none}
      .hero{padding:80px 0 60px}
      h1{font-size:42px}
      .footer-grid{grid-template-columns:1fr;gap:32px}
    }
  </style>
</head>
<body>

  <!-- GLASSMORPHISM HEADER -->
  <header>
    <div class="header-glass">
      <div class="container">
        <a href="index.html" class="logo">
          <div class="logo-mark"><img src="favicon.jpg" alt="ValQMS"></div>
          <span>ValQMS</span>
        </a>
        
        <nav id="mainNav">
          <a href="#tools">Tools</a>
          <a href="#qms">QMS Modules</a>
          <a href="qms_procedures.html">QMS Procedures</a>
          <a href="#resources">Resources</a>
          <a href="#about">About</a>
        </nav>

        <div class="header-controls">
          <!-- Background Selector -->
          <div class="bg-selector">
            <button class="bg-btn" id="bgBtn"><span>🎨</span><span>Background</span></button>
            <div class="bg-dropdown" id="bgDropdown">
              <div class="bg-option" data-bg="mesh"><div class="bg-preview mesh"></div><span>Mesh Gradient</span></div>
              <div class="bg-option" data-bg="gradient"><div class="bg-preview gradient"></div><span>Purple Gradient</span></div>
              <div class="bg-option" data-bg="dots"><div class="bg-preview dots"></div><span>Dot Pattern</span></div>
              <div class="bg-option" data-bg="waves"><div class="bg-preview waves"></div><span>Wave Motion</span></div>
              <div class="bg-option" data-bg="dark"><div class="bg-preview dark"></div><span>Dark Mode</span></div>
            </div>
          </div>

          <!-- Theme Selector -->
          <div class="theme-selector">
            <button class="theme-btn" id="themeBtn"><span>🎨</span><span>Theme</span></button>
            <div class="theme-dropdown" id="themeDropdown">
              <div class="theme-option" data-theme="green"><div class="theme-color green"></div><span>Green</span></div>
              <div class="theme-option" data-theme="cyan"><div class="theme-color cyan"></div><span>Cyan</span></div>
              <div class="theme-option" data-theme="purple"><div class="theme-color purple"></div><span>Purple</span></div>
              <div class="theme-option" data-theme="orange"><div class="theme-color orange"></div><span>Orange</span></div>
              <div class="theme-option" data-theme="blue"><div class="theme-color blue"></div><span>Blue</span></div>
              <div class="theme-option" data-theme="red"><div class="theme-color red"></div><span>Red</span></div>
              <div class="theme-option" data-theme="pink"><div class="theme-color pink"></div><span>Pink</span></div>
              <div class="theme-option" data-theme="teal"><div class="theme-color teal"></div><span>Teal</span></div>
              <div class="theme-option" data-theme="indigo"><div class="theme-color indigo"></div><span>Indigo</span></div>
              <div class="theme-option" data-theme="yellow"><div class="theme-color yellow"></div><span>Yellow</span></div>
              <div class="theme-option" data-theme="magenta"><div class="theme-color magenta"></div><span>Magenta</span></div>
              <div class="theme-option" data-theme="emerald"><div class="theme-color emerald"></div><span>Emerald</span></div>
              <div class="theme-option" data-theme="amber"><div class="theme-color amber"></div><span>Amber</span></div>
              <div class="theme-option" data-theme="lime"><div class="theme-color lime"></div><span>Lime</span></div>
              <div class="theme-option" data-theme="violet"><div class="theme-color violet"></div><span>Violet</span></div>
            </div>
          </div>

          <a class="btn-login" href="login.html" id="loginLink">Login</a>

<!-- User Menu -->
<div id="userMenu" class="user-menu">
  <div id="userBadge" class="user-badge">U</div>
  <div id="userDropdown" class="user-dropdown">
    <button id="profileBtn">👤 My Profile</button>
    <button id="logoutBtn">🚪 Logout</button>
  </div>
</div>

          <!-- Mobile Menu Button -->
          <button class="mobile-menu-btn" id="mobileMenuBtn">☰</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- Hero -->
    <section class="hero">
      <div class="container">
        <div class="pill"><span class="pill-dot"></span><span>Empowering Life Sciences organizations with browser native Advanced tools</span></div>
        <h1>Simplify Validation.<br>Strengthen Quality.<br>Accelerate Compliance.</h1>
        <p class="lead">ValQMS empowers Life Sciences organizations with various tools which aid in validation, automation, and regulatory compliance.</p>
        <div class="cta-group">
          <a href="#tools" class="cta"><span>Explore Tools</span><span>→</span></a>
          <a href="#resources" class="cta cta-secondary"><span>Regulatory Updates</span></a>
        </div>
      </div>
    </section>

    <!-- Tools -->
    <section id="tools">
      <div class="container">
        <div class="section-head">
          <h2>Automation Tools</h2>
          <p>Smart, compliant, and production-ready tools for validation documentation</p>
        </div>
        <div class="tools-scroll-wrapper">
          <div class="tools-list">
            <a href="ComparisionTool.html" class="tool-item"><div class="tool-icon">📊</div><div class="tool-content"><h3>Excel Comparison Tool</h3><p>Advanced fuzzy matching with composite keys and colorized Excel exports. Perfect for validation evidence generation.</p></div><div class="tool-arrow">→</div></a>
            <a href="MasterDataTool.html" class="tool-item"><div class="tool-icon">🧬</div><div class="tool-content"><h3>LIMS Master Data Tool</h3><p>Automatic master data structuring with smart multi-line detection and intelligent field mapping for LIMS templates.</p></div><div class="tool-arrow">→</div></a>
            <a href="SOPComparisionTool.html" class="tool-item"><div class="tool-icon">📝</div><div class="tool-content"><h3>SOP Version Comparator</h3><p>AI-powered side-by-side comparison with change detection, training impact analysis, and compliance reports.</p></div><div class="tool-arrow">→</div></a>
            <a href="AdvancedUserAcessMatrixTool.html" class="tool-item"><div class="tool-icon">🔐</div><div class="tool-content"><h3>User Access Matrix Builder</h3><p>Visual RBAC matrix with AI-powered segregation of duties conflict detection and GxP audit reports.</p></div><div class="tool-arrow">→</div></a>
            <a href="ScreenshotToTestEvidenceConverterTool.html" class="tool-item"><div class="tool-icon">📸</div><div class="tool-content"><h3>Screenshot Evidence Converter</h3><p>Batch annotate test screenshots with metadata, timestamps, and auto-generate PDF evidence appendices.</p></div><div class="tool-arrow">→</div></a>
            <a href="AdvancedRiskAssessmentTool.html" class="tool-item"><div class="tool-icon">🎯</div><div class="tool-content"><h3>AI Risk Assessment Tool</h3><p>GAMP 5 and ICH Q9 compliant risk scoring with automated validation strategy recommendations.</p></div><div class="tool-arrow">→</div></a>

          </div>
        </div>
      </div>
    </section>

    <!-- QMS Modules -->
    <section id="qms">
      <div class="container">
        <div class="section-head">
          <h2>Quality Management System</h2>
          <p>Complete pharmaceutical QMS procedures aligned with FDA 21 CFR Part 820, EU GMP, ICH Q10, and ISO 13485</p>
        </div>
        <div class="qms-grid">
          <div class="module-card"><h4>🔄 Change Control</h4><p>Manage controlled changes with risk evaluation, approvals, and full traceability</p></div>
          <div class="module-card"><h4>📊 Deviation Management</h4><p>Record, analyze, and close deviations efficiently with root cause analysis</p></div>
          <div class="module-card"><h4>🎯 CAPA Management</h4><p>Plan, execute, and track corrective and preventive actions systematically</p></div>
          <div class="module-card"><h4>⚠️ Risk Management</h4><p>Identify, assess, and mitigate risks using ICH Q9 compliant frameworks</p></div>
          <div class="module-card"><h4>🔍 Audit & Inspection</h4><p>Digital audit trails and inspection readiness with full documentation</p></div>
          <div class="module-card"><h4>🎓 Training Management</h4><p>Ensure training effectiveness tied to system and process changes</p></div>
        </div>
        <div class="qms-cta-wrapper">
          <a href="qms_procedures.html" class="cta"><span>View Complete QMS Documentation</span><span>→</span></a>
        </div>
      </div>
    </section>

    <!-- Resources -->
    <section id="resources">
      <div class="container">
        <div class="section-head">
          <h2>Regulatory Resources</h2>
          <p>Stay compliant with latest guidelines and regulatory updates</p>
        </div>
        <div class="resources-grid">
          <div class="resource-card">
            <div class="resource-icon">📚</div>
            <h3>Key Guidelines</h3>
            <ul>
              <li>📄 <a href="https://www.fda.gov" target="_blank">FDA 21 CFR Part 11</a></li>
              <li>📄 <a href="https://www.ema.europa.eu" target="_blank">EU Annex 11</a></li>
              <li>📄 <a href="https://www.ich.org" target="_blank">ICH Q9 Risk Management</a></li>
              <li>📄 <a href="https://ispe.org" target="_blank">GAMP 5 (2nd Edition)</a></li>
            </ul>
          </div>
          <div class="resource-card">
            <div class="resource-icon">📰</div>
            <h3>Regulatory Updates</h3>
            <ul>
              <li>🌐 <a href="https://www.fda.gov" target="_blank">FDA Guidance Documents</a></li>
              <li>🌐 <a href="https://www.ema.europa.eu" target="_blank">EMA News & Events</a></li>
              <li>🌐 <a href="https://www.who.int" target="_blank">WHO Quality Assurance</a></li>
            </ul>
          </div>
          <div class="resource-card">
            <div class="resource-icon">📰</div>
            <h3>Regulatory Observations</h3>
            <ul>
              <li>🌐 <a href="https://www.fda.gov" target="_blank">FDA Guidance Documents</a></li>
              <li>🌐 <a href="https://www.ema.europa.eu" target="_blank">EMA News & Events</a></li>
              <li>🌐 <a href="https://www.who.int" target="_blank">WHO Quality Assurance</a></li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- About -->
    <section id="about">
      <div class="container">
        <div class="section-head">
          <h2>Why ValQMS?</h2>
          <p>Built by validation experts for validation experts</p>
        </div>
        <div class="qms-grid">
          <div class="module-card"><h4>⚡ Lightning Fast</h4><p>Process thousands of validation records instantly with browser-native performance</p></div>
          <div class="module-card"><h4>🔒 Privacy First</h4><p>All processing happens locally. Your validation data never leaves your device</p></div>
          <div class="module-card"><h4>🎯 Zero Installation</h4><p>No software to install. Works instantly in any browser</p></div>
        </div>
      </div>
    </section>
  </main>

  <!-- MODERN FOOTER -->
  <footer>
    <div class="footer-content">
      <div class="container">
        <div class="footer-grid">
          <div class="footer-brand">
            <a href="index.html" class="logo">
              <div class="logo-mark"><img src="favicon.jpg" alt="ValQMS"></div>
              <span>ValQMS</span>
            </a>
            <p>Empowering Life Sciences organizations with browser-native advanced tools for validation, automation, and regulatory compliance.</p>
          </div>
          <div class="footer-col">
            <h5>Product</h5>
            <ul>
              <li><a href="#tools">Tools</a></li>
              <li><a href="#qms">QMS</a></li>
              <li><a href="qms_procedures.html">QMS Procedures</a></li>
              <li><a href="#resources">Resources</a></li>
            </ul>
          </div>
          <div class="footer-col">
            <h5>Company</h5>
            <ul>
              <li><a href="#about">About</a></li>
              <li><a href="mailto:support@valqms.com">Contact</a></li>
              <li><a href="Privacy.html">Privacy</a></li>
              <li><a href="Terms.html">Terms</a></li>
            </ul>
          </div>
          <div class="footer-col">
            <h5>Regulatory</h5>
            <ul>
              <li><a href="https://www.fda.gov" target="_blank">FDA</a></li>
              <li><a href="https://www.ema.europa.eu" target="_blank">EMA</a></li>
              <li><a href="https://www.who.int" target="_blank">WHO</a></li>
              <li><a href="https://www.ich.org" target="_blank">ICH</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>© 2025 ValQMS. Built with ❤️ by validation experts</p>
          <div class="footer-socials">
            <a href="#" title="Twitter">𝕏</a>
            <a href="#" title="LinkedIn">in</a>
            <a href="#" title="GitHub">{ }</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Profile Panel -->
  <div id="profilePanel">
    <div class="profile-content">
      <button class="close-btn" id="closeProfileBtn">×</button>
      
      <h2>My Profile</h2>
      <p id="profileMsg"></p>
      
      <div>
        <label>Full Name</label>
        <input id="pf_full_name" type="text" placeholder="Your full name">
      </div>
      
      <div>
        <label>Email</label>
        <input id="pf_email" type="email" placeholder="you@company.com" disabled>
      </div>
      
      <div>
        <label>Mobile Number</label>
        <input id="pf_phone" type="tel" placeholder="+91-XXXXXXXXXX">
      </div>
      
      <div class="btn-group">
        <button id="saveProfileBtn" class="btn btn-primary">Save Changes</button>
        <button class="btn btn-secondary" onclick="document.getElementById('profilePanel').style.display='none'">Close</button>
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="module">
  const SUPABASE_URL = 'https://nufpaayytxtjihqrvtfi.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im51ZnBhYXl5dHh0amlocXJ2dGZpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAzMzA5NjIsImV4cCI6MjA3NTkwNjk2Mn0.766ENc3lMQSVJIsyxK6xlPE5DNlB3Np3eeXxvcoRGGY';
  
  const { createClient } = supabase;
  const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

    // Check authentication immediately
  (async function checkAuth() {
    const { data: { session }, error } = await sb.auth.getSession();
    
    if (!session) {
      // No session - redirect to login
      console.log('No active session. Redirecting to login...');
      window.location.href = 'login.html';
      return;
    }
    
    // User is authenticated - show content
    console.log('User authenticated:', session.user.email);
    
    // Update UI with user info
    if (session && session.user) {
      const userMenu = document.getElementById('userMenu');
      const loginLink = document.getElementById('loginLink');
      const userBadge = document.getElementById('userBadge');
      
      if (loginLink) loginLink.style.display = 'none';
      if (userMenu) userMenu.style.display = 'inline-block';
      
      if (userBadge) {
        const displayName = session.user.user_metadata?.full_name || session.user.email.split('@')[0];
        userBadge.textContent = getInitials(displayName);
      }
      
      // Save to localStorage
      localStorage.setItem('valqmsUser', JSON.stringify({
        email: session.user.email,
        name: session.user.user_metadata?.full_name || session.user.email.split('@')[0],
        picture: session.user.user_metadata?.avatar_url,
        loggedIn: true,
        provider: session.user.app_metadata?.provider || 'email',
        timestamp: Date.now()
      }));
    }
  })();

  // Initialize theme FIRST
  const savedTheme = localStorage.getItem('valqmsTheme') || 'green';
  const savedBg = localStorage.getItem('valqmsBg') || 'mesh';
  document.documentElement.setAttribute('data-theme', savedTheme);
  document.documentElement.setAttribute('data-bg', savedBg);

  // Background selector
  const bgBtn = document.getElementById('bgBtn');
  const bgDropdown = document.getElementById('bgDropdown');
  const themeBtn = document.getElementById('themeBtn');
  const themeDropdown = document.getElementById('themeDropdown');

  if (bgBtn && bgDropdown) {
    bgBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      bgDropdown.classList.toggle('active');
      if (themeDropdown) themeDropdown.classList.remove('active');
    });

    document.querySelectorAll('.bg-option').forEach(opt => {
      opt.addEventListener('click', () => {
        const bg = opt.dataset.bg;
        document.documentElement.setAttribute('data-bg', bg);
        localStorage.setItem('valqmsBg', bg);
        bgDropdown.classList.remove('active');
      });
    });
  }

  // Theme selector
  if (themeBtn && themeDropdown) {
    themeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      themeDropdown.classList.toggle('active');
      if (bgDropdown) bgDropdown.classList.remove('active');
    });

    document.querySelectorAll('.theme-option').forEach(opt => {
      opt.addEventListener('click', () => {
        const theme = opt.dataset.theme;
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('valqmsTheme', theme);
        themeDropdown.classList.remove('active');
      });
    });
  }

  // Close dropdowns on outside click
  document.addEventListener('click', () => {
    if (bgDropdown) bgDropdown.classList.remove('active');
    if (themeDropdown) themeDropdown.classList.remove('active');
    const userDropdown = document.getElementById('userDropdown');
    if (userDropdown) userDropdown.classList.remove('active');
  });

  // Prevent dropdown close when clicking inside
  if (bgDropdown) bgDropdown.addEventListener('click', e => e.stopPropagation());
  if (themeDropdown) themeDropdown.addEventListener('click', e => e.stopPropagation());

  // User menu setup
  const loginLink = document.getElementById('loginLink');
  const userMenu = document.getElementById('userMenu');
  const userBadge = document.getElementById('userBadge');
  const userDropdown = document.getElementById('userDropdown');
  const profileBtn = document.getElementById('profileBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const profilePanel = document.getElementById('profilePanel');

  function getInitials(name) {
    if (!name) return 'U';
    const parts = name.trim().split(' ');
    if (parts.length >= 2) {
      return parts[0][0] + parts[parts.length - 1][0];
    }
    return name[0].toUpperCase();
  }

  async function updateUserUI() {
    try {
      const { data: { session } } = await sb.auth.getSession();
      
      if (session && session.user) {
        // User is logged in - show user menu
        if (loginLink) loginLink.style.display = 'none';
        if (userMenu) userMenu.style.display = 'inline-block';
        
        if (userBadge) {
          const displayName = session.user.user_metadata?.full_name || session.user.email.split('@')[0];
          userBadge.textContent = getInitials(displayName);
        }
        
        // Save to localStorage
        localStorage.setItem('valqmsUser', JSON.stringify({
          email: session.user.email,
          name: session.user.user_metadata?.full_name || session.user.email.split('@')[0],
          picture: session.user.user_metadata?.avatar_url,
          loggedIn: true,
          provider: session.user.app_metadata?.provider || 'email',
          timestamp: Date.now()
        }));
      } else {
        // No session - show login button
        if (userMenu) userMenu.style.display = 'none';
        if (loginLink) loginLink.style.display = 'inline-block';
        localStorage.removeItem('valqmsUser');
      }
    } catch (error) {
      console.error('Error checking auth:', error);
      if (userMenu) userMenu.style.display = 'none';
      if (loginLink) loginLink.style.display = 'inline-block';
    }
  }

  // Initialize user UI
  updateUserUI();

  // Toggle user dropdown
  if (userBadge && userDropdown) {
    userBadge.addEventListener('click', (e) => {
      e.stopPropagation();
      userDropdown.classList.toggle('active');
      if (themeDropdown) themeDropdown.classList.remove('active');
      if (bgDropdown) bgDropdown.classList.remove('active');
    });

    userDropdown.addEventListener('click', e => e.stopPropagation());
  }

  // Open profile panel
  if (profileBtn) {
    profileBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      e.stopPropagation();
      if (userDropdown) userDropdown.classList.remove('active');
      if (profilePanel) profilePanel.style.display = 'block';
      await loadProfile();
    });
  }

  // Logout functionality
  if (logoutBtn) {
    logoutBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      e.stopPropagation();
      
      try {
        await sb.auth.signOut();
        localStorage.removeItem('valqmsUser');
        
        if (userDropdown) userDropdown.classList.remove('active');
        if (userMenu) userMenu.style.display = 'none';
        if (loginLink) loginLink.style.display = 'inline-block';
        if (userBadge) userBadge.textContent = 'U';
        
        alert('You have been logged out successfully');
        setTimeout(() => window.location.href = 'login.html', 500);
      } catch (error) {
        console.error('Logout error:', error);
        alert('Logout failed. Please try again.');
      }
    });
  }

  // Profile panel functions
  const profileMsg = document.getElementById('profileMsg');
  const closeProfileBtn = document.getElementById('closeProfileBtn');
  const saveProfileBtn = document.getElementById('saveProfileBtn');

  async function loadProfile() {
    if (!profileMsg) return;
    profileMsg.textContent = 'Loading...';
    profileMsg.style.color = 'var(--text-dim)';
    
    try {
      const { data: { session } } = await sb.auth.getSession();
      if (!session) throw new Error('Not authenticated');
      
      const user = session.user;
      
      let { data: profile, error: fetchError } = await sb
        .from('user_profiles')
        .select('full_name, email, phone')
        .eq('id', user.id)
        .single();

      if (fetchError && fetchError.code !== 'PGRST116') {
        throw fetchError;
      }

      let profileData = profile;

      if (!profileData) {
        const insertData = {
          id: user.id,
          email: user.email,
          full_name: user.user_metadata?.full_name || user.email.split('@')[0] || '',
          phone: ''
        };

        const { data: created, error: insertError } = await sb
          .from('user_profiles')
          .insert(insertData)
          .select('full_name, email, phone')
          .single();

        if (insertError) throw insertError;
        profileData = created;
      }

      const fullNameInput = document.getElementById('pf_full_name');
      const emailInput = document.getElementById('pf_email');
      const phoneInput = document.getElementById('pf_phone');

      if (fullNameInput) fullNameInput.value = profileData.full_name || '';
      if (emailInput) emailInput.value = profileData.email || user.email;
      if (phoneInput) phoneInput.value = profileData.phone || '';

      profileMsg.textContent = '';
    } catch (error) {
      console.error('Load profile error:', error);
      profileMsg.style.color = '#f87171';
      profileMsg.textContent = 'Error loading profile: ' + error.message;
    }
  }

  async function saveProfile() {
    if (!profileMsg) return;
    profileMsg.textContent = 'Saving...';
    profileMsg.style.color = 'var(--text-dim)';
    
    try {
      const { data: { session } } = await sb.auth.getSession();
      if (!session) throw new Error('Not authenticated');
      
      const user = session.user;
      const fullName = document.getElementById('pf_full_name')?.value.trim() || '';
      const phone = document.getElementById('pf_phone')?.value.trim() || '';
      const email = document.getElementById('pf_email')?.value.trim() || user.email;

      const updates = {
        id: user.id,
        full_name: fullName || null,
        phone: phone || null,
        email,
        updated_at: new Date().toISOString()
      };

      const { error } = await sb
        .from('user_profiles')
        .upsert(updates, { onConflict: 'id' });

      if (error) throw error;

      // Update localStorage
      const userData = JSON.parse(localStorage.getItem('valqmsUser') || '{}');
      userData.name = fullName;
      userData.phone = phone;
      localStorage.setItem('valqmsUser', JSON.stringify(userData));

      // Update UI
      if (userBadge) {
        userBadge.textContent = getInitials(fullName);
      }

      profileMsg.style.color = 'var(--accent)';
      profileMsg.textContent = '✓ Profile updated successfully!';
      
      setTimeout(() => {
        if (profilePanel) profilePanel.style.display = 'none';
        profileMsg.textContent = '';
      }, 1500);
    } catch (error) {
      console.error('Save profile error:', error);
      profileMsg.style.color = '#f87171';
      profileMsg.textContent = 'Save failed: ' + error.message;
    }
  }

  if (saveProfileBtn) {
    saveProfileBtn.addEventListener('click', saveProfile);
  }

  if (closeProfileBtn) {
    closeProfileBtn.addEventListener('click', () => {
      if (profilePanel) profilePanel.style.display = 'none';
    });
  }

  // Close profile panel on backdrop click
  if (profilePanel) {
    profilePanel.addEventListener('click', (e) => {
      if (e.target === profilePanel) {
        profilePanel.style.display = 'none';
      }
    });
  }

  // Auth state listener
  sb.auth.onAuthStateChange((event, session) => {
    console.log('Auth state changed:', event);
    
    if (event === 'SIGNED_IN' && session) {
      localStorage.setItem('valqmsUser', JSON.stringify({
        email: session.user.email,
        name: session.user.user_metadata?.full_name || session.user.email.split('@')[0],
        picture: session.user.user_metadata?.avatar_url,
        loggedIn: true,
        provider: session.user.app_metadata?.provider || 'email',
        timestamp: Date.now()
      }));
      updateUserUI();
    } else if (event === 'SIGNED_OUT') {
      localStorage.removeItem('valqmsUser');
      if (userMenu) userMenu.style.display = 'none';
      if (loginLink) loginLink.style.display = 'inline-block';
      if (userBadge) userBadge.textContent = 'U';
    }
  });

</script>

</body>
</html>
