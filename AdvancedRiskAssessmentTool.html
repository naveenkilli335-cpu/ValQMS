<!DOCTYPE html>
<html lang="en" data-theme="green" data-bg="mesh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Advanced Risk Assessment Tool ‚Äî ValQMS</title>
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <link rel="icon" href="valqms-logo.svg" sizes="any">
  <link rel="apple-touch-icon" sizes="180x180" href="favicon.jpg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/theme.css">
  
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    
    /* Theme Colors */
    [data-theme="green"]{--accent:#10b981;--accent-bright:#34d399;--accent-dim:rgba(16,185,129,0.15);--accent-glow:rgba(16,185,129,0.4)}
    [data-theme="cyan"]{--accent:#06b6d4;--accent-bright:#22d3ee;--accent-dim:rgba(6,182,212,0.15);--accent-glow:rgba(6,182,212,0.4)}
    [data-theme="purple"]{--accent:#8b5cf6;--accent-bright:#a78bfa;--accent-dim:rgba(139,92,246,0.15);--accent-glow:rgba(139,92,246,0.4)}
    [data-theme="orange"]{--accent:#f97316;--accent-bright:#fb923c;--accent-dim:rgba(249,115,22,0.15);--accent-glow:rgba(249,115,22,0.4)}
    [data-theme="blue"]{--accent:#3b82f6;--accent-bright:#60a5fa;--accent-dim:rgba(59,130,246,0.15);--accent-glow:rgba(59,130,246,0.4)}
    [data-theme="red"]{--accent:#ef4444;--accent-bright:#f87171;--accent-dim:rgba(239,68,68,0.15);--accent-glow:rgba(239,68,68,0.4)}
    [data-theme="pink"]{--accent:#ec4899;--accent-bright:#f472b6;--accent-dim:rgba(236,72,153,0.15);--accent-glow:rgba(236,72,153,0.4)}
    [data-theme="teal"]{--accent:#14b8a6;--accent-bright:#2dd4bf;--accent-dim:rgba(20,184,166,0.15);--accent-glow:rgba(20,184,166,0.4)}
    [data-theme="indigo"]{--accent:#6366f1;--accent-bright:#818cf8;--accent-dim:rgba(99,102,241,0.15);--accent-glow:rgba(99,102,241,0.4)}
    [data-theme="yellow"]{--accent:#eab308;--accent-bright:#facc15;--accent-dim:rgba(234,179,8,0.15);--accent-glow:rgba(234,179,8,0.4)}
    [data-theme="magenta"]{--accent:#d946ef;--accent-bright:#e879f9;--accent-dim:rgba(217,70,239,0.15);--accent-glow:rgba(217,70,239,0.4)}
    [data-theme="emerald"]{--accent:#059669;--accent-bright:#10b981;--accent-dim:rgba(5,150,105,0.15);--accent-glow:rgba(5,150,105,0.4)}
    [data-theme="amber"]{--accent:#d97706;--accent-bright:#f59e0b;--accent-dim:rgba(217,119,6,0.15);--accent-glow:rgba(217,119,6,0.4)}
    [data-theme="lime"]{--accent:#84cc16;--accent-bright:#a3e635;--accent-dim:rgba(132,204,22,0.15);--accent-glow:rgba(132,204,22,0.4)}
    [data-theme="violet"]{--accent:#7c3aed;--accent-bright:#a78bfa;--accent-dim:rgba(124,58,237,0.15);--accent-glow:rgba(124,58,237,0.4)}

    :root{
      --text:#ffffff;
      --text-dim:#94a3b8;
      --surface:rgba(255,255,255,0.05);
      --surface-hover:rgba(255,255,255,0.08);
      --border:rgba(255,255,255,0.1);
      --glass:rgba(255,255,255,0.03);
      --ok:#10b981;
      --warn:#fbbf24;
      --err:#ef4444;
    }

    /* ANIMATED BACKGROUNDS */
    [data-bg="mesh"] body{background:#0f172a;position:relative}
    [data-bg="mesh"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%, rgba(16,185,129,0.15) 0%, transparent 50%),radial-gradient(circle at 80% 80%, rgba(99,102,241,0.15) 0%, transparent 50%),radial-gradient(circle at 40% 80%, rgba(236,72,153,0.1) 0%, transparent 50%);animation:meshMove 15s ease-in-out infinite alternate;z-index:-1}

    [data-bg="gradient"] body{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);position:relative}
    [data-bg="gradient"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg, transparent 0%, rgba(0,0,0,0.3) 100%);z-index:-1}

    [data-bg="dots"] body{background:#0a0e27;position:relative}
    [data-bg="dots"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);background-size:30px 30px;z-index:-1}

    [data-bg="waves"] body{background:#0f172a;position:relative}
    [data-bg="waves"] body::before{content:'';position:fixed;bottom:0;left:0;width:100%;height:400px;background:linear-gradient(180deg, transparent 0%, rgba(16,185,129,0.1) 100%);animation:waveMove 8s ease-in-out infinite;z-index:-1}

    [data-bg="dark"] body{background:#0a0e1a;position:relative}
    [data-bg="dark"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center, rgba(59,130,246,0.05) 0%, transparent 70%);z-index:-1}

    /* Mint Theme */
    [data-bg="mint"] body{background:#d1fae5;position:relative}
    [data-bg="mint"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%, rgba(16,185,129,0.08) 0%, transparent 50%),radial-gradient(circle at 80% 80%, rgba(52,211,153,0.08) 0%, transparent 50%);z-index:-1}

    /* Light theme color overrides for mint background */
    [data-bg="mint"] {
      --text: #1e293b;
      --text-dim: #475569;
      --surface: rgba(255,255,255,0.9);
      --surface-hover: rgba(255,255,255,1);
      --border: rgba(16,185,129,0.2);
      --glass: rgba(255,255,255,0.95);
      --ok: #059669;
      --warn: #d97706;
      --err: #dc2626;
    }

    [data-bg="mint"] .header-glass {
      background: rgba(255,255,255,0.95);
      border: 1px solid rgba(16,185,129,0.2);
      box-shadow: 0 8px 32px rgba(0,0,0,0.05);
    }

    [data-bg="mint"] .card {
      background: rgba(255,255,255,0.95);
      border: 1px solid rgba(16,185,129,0.2);
      box-shadow: 0 4px 16px rgba(0,0,0,0.03);
    }

    [data-bg="mint"] .card:hover {
      border-color: var(--accent);
      box-shadow: 0 8px 24px rgba(16,185,129,0.1);
    }

    [data-bg="mint"] select option {
      background: white !important;
      color: #1e293b !important;
    }

    [data-bg="mint"] .result-section {
      background: white;
      border: 1px solid rgba(16,185,129,0.2);
      color: #1e293b !important;
    }

    [data-bg="mint"] .result-section p,
    [data-bg="mint"] .result-section ul {
      color: #64748b !important;
    }

    [data-bg="mint"] .result-section h4 {
      color: #059669 !important;
    }

    [data-bg="mint"] .result-section strong {
      color: #1e293b !important;
      font-weight: 600;
    }

    [data-bg="mint"] input[type="text"],
    [data-bg="mint"] textarea,
    [data-bg="mint"] select {
      color: #1e293b !important;
      background: white !important;
    }

    [data-bg="mint"] input::placeholder,
    [data-bg="mint"] textarea::placeholder {
      color: #94a3b8 !important;
    }

    @keyframes meshMove{0%{transform:scale(1) rotate(0deg)}100%{transform:scale(1.1) rotate(5deg)}}
    @keyframes waveMove{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    
    html{scroll-behavior:smooth}
    body{
      font-family:'Inter',system-ui,-apple-system,sans-serif;
      color:var(--text);
      line-height:1.6;
      -webkit-font-smoothing:antialiased;
      transition:background 0.5s ease;
      min-height:100vh;
      overflow-x:hidden;
    }

    /* GLASSMORPHISM HEADER - FIXED */
    header{
      position: fixed;
      top: 12px;
      left: 0;
      right: 0;
      z-index: 1000;
      padding: 0 24px;
      pointer-events: none;
    }
    .header-glass{
      background:#0f172a !important;
      backdrop-filter:blur(20px) saturate(180%);
      -webkit-backdrop-filter:blur(20px) saturate(180%);
      border:1px solid rgba(255,255,255,0.08) !important;
      border-radius:20px;
      padding:16px 32px;
      box-shadow:0 8px 32px rgba(0,0,0,0.2),inset 0 1px 0 rgba(255,255,255,0.06);
      color:#fff;
      pointer-events:auto;
    }
    header .header-container{
      display:flex;
      justify-content:space-between;
      align-items:center;
      width:100%;
      max-width:none;
      margin:0;
    }
    
    /* Add padding to body to account for fixed header */
    body {
      padding-top: 72px;
    }
    /* Index-style dark header link/control colors */
    header .header-glass nav a { color: rgba(255,255,255,0.9) !important; }
    header .header-glass nav a:hover { color: #fff !important; background: rgba(255,255,255,0.12); }
    header .logo span { color: #fff !important; }
    header .bg-btn,
    header .theme-btn,
    header .mobile-menu-btn,
    header .user-badge,
    header .btn-login {
      background: #ffffff !important;
      border: 1px solid #e5e7eb !important;
      color: #0f172a !important;
      box-shadow: 0 1px 2px rgba(15,23,42,0.06), 0 1px 1px rgba(15,23,42,0.03) !important;
    }
    header .bg-btn:hover,
    header .theme-btn:hover,
    header .mobile-menu-btn:hover,
    header .user-badge:hover,
    header .btn-login:hover {
      background: #ffffff !important;
      border-color: var(--accent) !important;
      color: #0f172a !important;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(16,185,129,0.15) !important;
    }

    .container {
      max-width: 1400px;
      margin: 24px auto 0; /* increased gap under header */
      padding: 0 24px;
    }
    
    .logo{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text);font-weight:800;font-size:22px;letter-spacing:-0.7px;transition:all 0.3s}
    .logo:hover{transform:translateY(-2px)}
    .logo-mark{display:flex;align-items:center;justify-content:center;width:40px;height:40px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));border-radius:12px;box-shadow:0 4px 20px var(--accent-glow);transition:all 0.3s;position:relative}
    .logo-mark::after{content:'';position:absolute;inset:-2px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));border-radius:14px;z-index:-1;opacity:0;filter:blur(10px);transition:opacity 0.3s}
    .logo-mark:hover::after{opacity:0.7}
    .logo-mark img{width:100%;height:100%;object-fit:contain;padding:4px}
    /* Index-style initials inside gradient logo square */
    .logo-mark .brand-initials{
      font-weight:900;
      font-size:18px;
      letter-spacing:-0.5px;
      color:#fff;
      text-shadow:0 1px 2px rgba(0,0,0,0.25);
    }
    .brand-text{display:flex;flex-direction:column}
    .brand-text h1{font-size:18px;font-weight:800;letter-spacing:-0.5px;margin:0;line-height:1.2}
  .brand-text .subtitle{font-size:12px;color:var(--text-dim);font-weight:500}
  /* Force readable brand text in header on dark glass, even under light/mint overrides */
  header .brand-text h1, header .brand-text .subtitle { color:#fff !important; -webkit-text-fill-color:#fff !important; }
  html[data-bg="mint"] header .brand-text h1, html[data-bg="mint"] header .brand-text .subtitle { color:#fff !important; -webkit-text-fill-color:#fff !important; }

    .header-controls{display:flex;gap:12px;align-items:center}
    
    .bg-selector{position:relative}
    .bg-btn{padding:10px 18px;background:var(--surface);border:1px solid var(--border);border-radius:12px;color:var(--text-dim);font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.3s}
    .bg-btn:hover{background:var(--surface-hover);border-color:var(--accent);color:var(--text)}
    .bg-dropdown{position:absolute;top:calc(100% + 12px);right:0;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:12px;display:none;min-width:200px;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:100}
    .bg-dropdown.active{display:block}
    .bg-option{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;cursor:pointer;transition:all 0.3s;font-size:14px;font-weight:500}
    .bg-option:hover{background:var(--surface-hover)}
    .bg-preview{width:32px;height:32px;border-radius:8px;border:2px solid rgba(255,255,255,0.2)}
    .bg-preview.mesh{background:radial-gradient(circle, #10b981 0%, #6366f1 100%)}
    .bg-preview.gradient{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%)}
    .bg-preview.dots{background:#0a0e27;background-image:radial-gradient(circle, rgba(255,255,255,0.2) 1px, transparent 1px);background-size:15px 15px}
    .bg-preview.waves{background:linear-gradient(180deg, #0f172a 0%, #10b981 100%)}
    .bg-preview.dark{background:#0a0e1a}

    .theme-selector{position:relative}
    .theme-btn{padding:10px 18px;background:var(--surface);border:1px solid var(--border);border-radius:12px;color:var(--text-dim);font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.3s}
    .theme-btn:hover{background:var(--surface-hover);border-color:var(--accent);color:var(--text)}
    .theme-dropdown{position:absolute;top:calc(100% + 12px);right:0;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:12px;display:none;min-width:200px;max-height:400px;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:100}
    .theme-dropdown.active{display:block}
    .theme-dropdown::-webkit-scrollbar{width:6px}
    .theme-dropdown::-webkit-scrollbar-track{background:transparent}
    .theme-dropdown::-webkit-scrollbar-thumb{background:var(--accent);border-radius:10px}
    .theme-option{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;cursor:pointer;transition:all 0.3s;font-size:14px;font-weight:500}
    .theme-option:hover{background:var(--surface-hover)}
    .theme-color{width:28px;height:28px;border-radius:8px;border:2px solid rgba(255,255,255,0.2);transition:all 0.3s}
    .theme-option:hover .theme-color{transform:scale(1.1)}
    .theme-color.green{background:linear-gradient(135deg,#10b981,#34d399)}
    .theme-color.cyan{background:linear-gradient(135deg,#06b6d4,#22d3ee)}
    .theme-color.purple{background:linear-gradient(135deg,#8b5cf6,#a78bfa)}
    .theme-color.orange{background:linear-gradient(135deg,#f97316,#fb923c)}
    .theme-color.blue{background:linear-gradient(135deg,#3b82f6,#60a5fa)}
    .theme-color.red{background:linear-gradient(135deg,#ef4444,#f87171)}
    .theme-color.pink{background:linear-gradient(135deg,#ec4899,#f472b6)}
    .theme-color.teal{background:linear-gradient(135deg,#14b8a6,#2dd4bf)}
    .theme-color.indigo{background:linear-gradient(135deg,#6366f1,#818cf8)}
    .theme-color.yellow{background:linear-gradient(135deg,#eab308,#facc15)}
    .theme-color.magenta{background:linear-gradient(135deg,#d946ef,#e879f9)}
    .theme-color.emerald{background:linear-gradient(135deg,#059669,#10b981)}
    .theme-color.amber{background:linear-gradient(135deg,#d97706,#f59e0b)}
    .theme-color.lime{background:linear-gradient(135deg,#84cc16,#a3e635)}
    .theme-color.violet{background:linear-gradient(135deg,#7c3aed,#a78bfa)}

  .btn-home{padding:10px 20px;background:linear-gradient(135deg,#10b981,#34d399);border:none;border-radius:12px;color:#000;font-size:14px;font-weight:700;text-decoration:none;transition:all 0.3s;display:inline-flex;align-items:center;gap:8px;box-shadow:0 4px 16px rgba(16,185,129,0.4)}
  .btn-home:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(16,185,129,0.4)}

  .container{width:100%;max-width:none;margin:24px 0 0;padding:0 24px}
    
    .card{
      background:var(--glass);
      backdrop-filter:blur(10px);
      padding:28px;
      border-radius:18px;
      border:1px solid var(--border);
      margin-bottom:20px;
      transition:all 0.3s;
    }
    .card:hover{border-color:var(--accent);box-shadow:0 8px 24px rgba(0,0,0,0.2)}
    .card h3{font-size:18px;font-weight:700;margin:0 0 20px 0;letter-spacing:-0.3px}

    /* Multi-Step Progress Bar */
    /* Multi-Step Progress Bar */
    .progress-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 32px;
      position: relative;
      gap: 8px;
    }

    .progress-bar::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 10%;
      right: 10%;
      height: 2px;
      background: var(--border);
      z-index: 0;
    }

    .progress-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--text-dim);
      position: relative;
      z-index: 1;
      flex: 1;
      cursor: pointer;
      transition: all 0.3s;
    }

    .progress-step span {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--surface);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      transition: all 0.3s;
    }

    .progress-step.active span {
      background: linear-gradient(135deg,var(--accent),var(--accent-bright));
      border-color: var(--accent);
      color: #000;
      box-shadow: 0 0 20px var(--accent-glow);
    }

    .progress-step.active {
      color: var(--text);
      font-weight: 600;
    }

    .progress-step.completed span {
      background: var(--surface);
      border-color: var(--accent);
      color: var(--accent);
    }

    [data-bg="mint"] .progress-step {
      color: var(--text-dim);
    }

    [data-bg="mint"] .progress-step.active {
      color: var(--text);
    }

    [data-bg="mint"] .progress-bar::before {
      background: rgba(16,185,129,0.2);
    }

    .form-step{display:none;animation:fadeIn 0.3s ease-in}
    .form-step.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    .field{margin-bottom:16px}
    /* Form Labels */
    label {
      display: block;
      font-size: 13px;
      color: var(--text-dim);
      margin-bottom: 8px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    [data-bg="mint"] label {
      color: #475569;
    }
    
    /* Form Controls */
    input[type=text],
    textarea,
    select {
      width: 100%;
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      font-size: 14px;
      transition: all 0.3s;
      font-family: inherit;
    }
    
    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
      background: var(--surface-hover);
    }

    [data-bg="mint"] input[type=text],
    [data-bg="mint"] textarea,
    [data-bg="mint"] select {
      color: #1e293b;
      background: white;
      border: 1px solid rgba(16,185,129,0.2);
    }

    [data-bg="mint"] input:focus,
    [data-bg="mint"] textarea:focus,
    [data-bg="mint"] select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(16,185,129,0.1);
      background: white;
    }

    input::placeholder,
    textarea::placeholder {
      color:var(--text-dim);
      opacity:0.6;
    }

    select option {
      background:#1a1f2e !important;
      color:#ffffff !important;
      padding:10px;
    }
    
    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:12px 24px;
      background:linear-gradient(135deg,var(--accent),var(--accent-bright));
      color:#000;
      border:none;
      border-radius:12px;
      font-size:14px;
      font-weight:700;
      cursor:pointer;
      transition:all 0.3s;
      box-shadow:0 4px 16px var(--accent-glow);
      margin-top:8px;
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px var(--accent-glow)}
    
    .btn-secondary{
      background:var(--surface);
      color:var(--text);
      box-shadow:none;
      border:1px solid var(--border);
    }
    .btn-secondary:hover{
      background:var(--surface-hover);
      border-color:var(--accent);
    }

    .btn-group{display:flex;gap:12px;margin-top:24px;flex-wrap:wrap}
    
    /* Risk Badge Styles */
    .risk-badge {
      display: inline-block;
      padding: 12px 28px;
      border-radius: 999px;
      font-size: 16px;
      font-weight: 700;
      margin: 12px 0;
      letter-spacing: -0.3px;
      border-width: 2px;
      border-style: solid;
    }

    /* Dark theme risk badges */
    :not([data-bg="mint"]) .risk-low {
      background: rgba(52,211,153,0.2);
      color: #34d399;
      border-color: #34d399;
    }
    :not([data-bg="mint"]) .risk-medium {
      background: rgba(250,204,21,0.2);
      color: #facc15;
      border-color: #facc15;
    }
    :not([data-bg="mint"]) .risk-high {
      background: rgba(239,68,68,0.2);
      color: #f87171;
      border-color: #f87171;
    }

    /* Mint theme risk badges */
    [data-bg="mint"] .risk-low {
      background: rgba(16,185,129,0.1);
      color: #059669;
      border-color: #059669;
    }
    [data-bg="mint"] .risk-medium {
      background: rgba(217,119,6,0.1);
      color: #b45309;
      border-color: #b45309;
    }
    [data-bg="mint"] .risk-high {
      background: rgba(220,38,38,0.1);
      color: #b91c1c;
      border-color: #b91c1c;
    }
    
    .result-section{
      background:var(--glass);
      backdrop-filter:blur(10px);
      padding:24px;
      border-radius:14px;
      margin-top:20px;
      border:1px solid var(--border);
    }
    .result-section h4{
      margin-bottom:16px;
      color:var(--accent);
      font-size:16px;
      font-weight:700;
      letter-spacing:-0.3px;
    }
    .result-section p{
      line-height:1.9;
      color:var(--text);
      font-size:14px;
      font-weight:400;
    }
    .result-section ul{
      margin-left:24px;
      line-height:2;
      color:var(--text);
      font-size:14px;
      font-weight:400;
    }
    .result-section strong{color:var(--text);font-weight:600}

    @media(max-width:968px){
      header{top:8px;padding:0 16px}
      .header-glass{padding:0 20px;border-radius:16px}
      .header-controls{gap:8px}
      .bg-btn,.theme-btn{padding:10px;font-size:0}
      .bg-btn span:last-child,.theme-btn span:last-child{display:none}
      .progress-bar{font-size:11px}
      .progress-step span{width:32px;height:32px;font-size:12px}
    }
  </style>
</head>
<body>

  <header>
    <div class="header-glass">
      <div class="header-container">
  <a href="/" class="logo">
          <div class="logo-mark"><span class="brand-initials">VQ</span></div>
          <div class="brand-text">
            <h1>ValQMS Tools</h1>
            <div class="subtitle">AI Risk Assessment (GAMP 5 / ICH Q9)</div>
          </div>
        </a>

        <div class="header-controls">
          <a href="/" class="btn-home"><span>‚Üê</span><span>Home</span></a>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="card">
      <div class="progress-bar">
        <div class="progress-step active" data-step="1"><span>1</span> System Info</div>
        <div class="progress-step" data-step="2"><span>2</span> Technical</div>
        <div class="progress-step" data-step="3"><span>3</span> Compliance</div>
        <div class="progress-step" data-step="4"><span>4</span> Operations</div>
      </div>

      <!-- Step 1 -->
      <div class="form-step active" data-step="1">
        <h3>üéØ System Information</h3>
        <div class="field">
          <label>System Name</label>
          <input type="text" id="systemName" placeholder="e.g., LabWare LIMS v7.2">
        </div>
        <div class="field">
          <label>System Type</label>
          <select id="systemType">
            <option>LIMS (Laboratory Information Management)</option>
            <option>ERP (Enterprise Resource Planning)</option>
            <option>MES (Manufacturing Execution System)</option>
            <option>QMS (Quality Management System)</option>
            <option>EDMS (Electronic Document Management)</option>
            <option>CDS (Chromatography Data System)</option>
            <option>ELN (Electronic Lab Notebook)</option>
            <option>Custom Application</option>
          </select>
        </div>
        <div class="field">
          <label>System Category (GAMP 5)</label>
          <select id="gampCategory">
            <option value="1">Category 1: Infrastructure Software (OS, Database)</option>
            <option value="3">Category 3: Non-configured Product (COTS)</option>
            <option value="4">Category 4: Configured Product</option>
            <option value="5" selected>Category 5: Custom Application</option>
          </select>
        </div>
        <div class="field">
          <label>Deployment Model</label>
          <select id="deployment">
            <option>On-Premise</option>
            <option>Cloud (SaaS)</option>
            <option>Hybrid</option>
            <option>Validated Cloud (AWS/Azure GxP)</option>
          </select>
        </div>
        <div class="btn-group">
          <button class="btn" onclick="nextStep()">Next <span>‚Üí</span></button>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="form-step" data-step="2">
        <h3>‚öôÔ∏è Technical Assessment</h3>
        <div class="field">
          <label>System Complexity</label>
          <select id="complexity">
            <option>Simple - Basic CRUD, minimal business logic</option>
            <option selected>Moderate - Business logic, some integrations</option>
            <option>Complex - Advanced workflows, multiple integrations</option>
            <option>Very Complex - AI/ML, real-time processing, critical algorithms</option>
          </select>
        </div>
        <div class="field">
          <label>Number of Integrations</label>
          <select id="integrations">
            <option>0 - Standalone system</option>
            <option>1-3 - Few integrations</option>
            <option selected>4-7 - Multiple integrations</option>
            <option>8+ - Highly integrated</option>
          </select>
        </div>
        <div class="field">
          <label>Data Volume</label>
          <select id="dataVolume">
            <option>Low - < 1GB, < 1000 records/day</option>
            <option selected>Medium - 1-100GB, 1K-10K records/day</option>
            <option>High - 100GB-1TB, 10K-100K records/day</option>
            <option>Very High - > 1TB, > 100K records/day</option>
          </select>
        </div>
        <div class="field">
          <label>System Maturity</label>
          <select id="maturity">
            <option>New/Prototype - First deployment</option>
            <option>Developing - Early versions, frequent changes</option>
            <option selected>Mature - Established, stable releases</option>
            <option>Legacy - Old technology, maintenance mode</option>
          </select>
        </div>
        <div class="field">
          <label>Vendor Support Quality</label>
          <select id="vendorSupport">
            <option>Poor - Limited support, slow response</option>
            <option>Fair - Basic support available</option>
            <option selected>Good - Responsive, documented processes</option>
            <option>Excellent - 24/7 support, GxP expertise</option>
          </select>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="prevStep()"><span>‚Üê</span> Previous</button>
          <button class="btn" onclick="nextStep()">Next <span>‚Üí</span></button>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="form-step" data-step="3">
        <h3>üìã Compliance & Regulatory</h3>
        <div class="field">
          <label>Does System Handle GxP Data?</label>
          <select id="gxpData">
            <option>No - Non-GxP system</option>
            <option selected>Yes - GxP critical data</option>
          </select>
        </div>
        <div class="field">
          <label>Regulatory Scope</label>
          <select id="regulatoryScope">
            <option>FDA (US) Only</option>
            <option>EMA (EU) Only</option>
            <option selected>FDA + EMA (Global)</option>
            <option>MHRA (UK)</option>
            <option>Multiple Regions (FDA, EMA, PMDA, etc.)</option>
          </select>
        </div>
        <div class="field">
          <label>Electronic Signatures (21 CFR Part 11)</label>
          <select id="eSig">
            <option>No</option>
            <option selected>Yes</option>
          </select>
        </div>
        <div class="field">
          <label>Audit Trail Requirements</label>
          <select id="auditTrail">
            <option>No audit trail required</option>
            <option>Basic - Create/Update/Delete logging</option>
            <option selected>Comprehensive - All data changes tracked</option>
            <option>Advanced - Real-time monitoring, tamper-proof</option>
          </select>
        </div>
        <div class="field">
          <label>Data Integrity Risk (ALCOA+)</label>
          <select id="dataIntegrity">
            <option>Low - Minimal DI concerns</option>
            <option selected>Medium - Standard DI controls needed</option>
            <option>High - Critical DI controls, inspection history</option>
          </select>
        </div>
        <div class="field">
          <label>Patient Safety Impact</label>
          <select id="patientSafety">
            <option>None - No direct patient impact</option>
            <option>Indirect - Supply chain, quality data</option>
            <option selected>Direct - Clinical data, batch release</option>
            <option>Critical - Life-saving drug manufacturing</option>
          </select>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="prevStep()"><span>‚Üê</span> Previous</button>
          <button class="btn" onclick="nextStep()">Next <span>‚Üí</span></button>
        </div>
      </div>

      <!-- Step 4 -->
      <div class="form-step" data-step="4">
        <h3>üè¢ Operational Factors</h3>
        <div class="field">
          <label>Business Impact if System Fails</label>
          <select id="businessImpact">
            <option>Low - Minor inconvenience, workarounds available</option>
            <option>Medium - Significant disruption, delays possible</option>
            <option selected>High - Critical operations stop, revenue loss</option>
            <option>Catastrophic - Patient safety risk, regulatory action</option>
          </select>
        </div>
        <div class="field">
          <label>Number of Users</label>
          <select id="users">
            <option>1-10 users</option>
            <option>11-50 users</option>
            <option selected>51-200 users</option>
            <option>200+ users</option>
          </select>
        </div>
        <div class="field">
          <label>Geographic Distribution</label>
          <select id="geography">
            <option>Single site</option>
            <option selected>Multiple sites (same region)</option>
            <option>Global (multiple regions)</option>
          </select>
        </div>
        <div class="field">
          <label>Change Frequency</label>
          <select id="changeFreq">
            <option>Rare - < 1 change per year</option>
            <option>Low - 1-4 changes per year</option>
            <option selected>Moderate - 5-12 changes per year</option>
            <option>High - Monthly or more frequent changes</option>
          </select>
        </div>
        <div class="field">
          <label>Historical Issues</label>
          <select id="history">
            <option>No known issues</option>
            <option selected>Minor issues, resolved quickly</option>
            <option>Moderate issues, some downtime</option>
            <option>Major issues, FDA observations, recalls</option>
          </select>
        </div>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="prevStep()"><span>‚Üê</span> Previous</button>
          <button class="btn" onclick="performAssessment()">
            <span>ü§ñ</span><span>Perform AI Risk Assessment</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize theme and background
    function initTheme(){
      const savedTheme=localStorage.getItem('valqmsTheme')||'green';
      const savedBg=localStorage.getItem('valqmsBg')||'mesh';
      document.documentElement.setAttribute('data-theme',savedTheme);
      document.documentElement.setAttribute('data-bg',savedBg);
    }
    initTheme();

    // Removed interactive theme/background selectors for tools; using saved defaults only

    // Multi-step navigation
    let currentStep = 1;
    
    function showStep(step) {
      console.log('Showing step:', step); // Debug log
      
      // Hide all steps
      document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
      
      // Update progress bar
      document.querySelectorAll('.progress-step').forEach((s, index) => {
        s.classList.remove('active', 'completed');
        if (index + 1 === step) {
          s.classList.add('active');
        } else if (index + 1 < step) {
          s.classList.add('completed');
        }
      });
      
      // Show current step
      const stepElement = document.querySelector(`.form-step[data-step="${step}"]`);
      if (stepElement) {
        stepElement.classList.add('active');
        currentStep = step;
        
        // Scroll to top of form
        stepElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      } else {
        console.error('Step element not found:', step);
      }
    }
    
    function nextStep() {
      console.log('Next step called, current:', currentStep);
      if (currentStep < 4) {
        showStep(currentStep + 1);
      }
    }
    
    function prevStep() {
      console.log('Previous step called, current:', currentStep);
      if (currentStep > 1) {
        showStep(currentStep - 1);
      }
    }

    // Click on progress bar to navigate
    document.querySelectorAll('.progress-step').forEach((step, index) => {
      step.addEventListener('click', () => {
        showStep(index + 1);
      });
    });

    // Risk assessment
    let assessmentResult = {};
    
    function performAssessment() {
      console.log('Performing assessment...');
      
      const gamp = parseInt(document.getElementById('gampCategory').value);
      const impact = document.getElementById('businessImpact').value;
      const gxp = document.getElementById('gxpData').value;
      const eSig = document.getElementById('eSig').value;
      const complexity = document.getElementById('complexity').value;
      
      let riskScore = 0;
      
      // Calculate risk score
      if(gamp===5) riskScore+=30;
      else if(gamp===4) riskScore+=20;
      else riskScore+=10;
      
      if(impact.includes('High') || impact.includes('Catastrophic')) riskScore+=30;
      else if(impact.includes('Medium')) riskScore+=20;
      else riskScore+=10;
      
      if(gxp.includes('Yes')) riskScore+=20;
      if(eSig==='Yes') riskScore+=15;
      
      if(complexity.includes('Very Complex')) riskScore+=30;
      else if(complexity.includes('Complex')) riskScore+=25;
      else if(complexity.includes('Moderate')) riskScore+=15;
      else riskScore+=5;
      
      // Determine risk level
      let riskLevel='Low', riskClass='risk-low';
      if(riskScore>=70){
        riskLevel='High';
        riskClass='risk-high';
      } else if(riskScore>=40){
        riskLevel='Medium';
        riskClass='risk-medium';
      }
      
      const strategies={
        Low:'Reduced validation: Focus on critical functions only. Vendor testing may be leveraged.',
        Medium:'Standard validation: IQ, OQ, PQ with comprehensive test coverage. Traceability matrix required.',
        High:'Enhanced validation: Full lifecycle validation with extensive testing, independent review, and detailed documentation.'
      };
      
      const activities={
        Low:['Requirements review','Installation verification','Critical function testing','User acceptance'],
        Medium:['Full IQ/OQ/PQ protocols','Requirements traceability','Risk-based testing','Audit trail verification','21 CFR Part 11 compliance'],
        High:['Comprehensive IQ/OQ/PQ','Code review (if custom)','Security testing','Performance testing','Disaster recovery testing','Full regression suite','Independent QA review']
      };
      
      assessmentResult = {
        riskScore,
        riskLevel,
        riskClass,
        strategy: strategies[riskLevel],
        activities: activities[riskLevel]
      };
      
      // Create results card
      const resultsHTML = `
        <div class="card" id="resultsCard" style="margin-top:32px">
          <h3>üìä Risk Assessment Results</h3>
          <div class="risk-badge ${riskClass}">Risk Level: ${riskLevel} (Score: ${riskScore}/120)</div>
          
          <div class="result-section">
            <h4>Validation Strategy</h4>
            <p>${strategies[riskLevel]}</p>
          </div>
          
          <div class="result-section">
            <h4>Required Test Activities</h4>
            <ul>${activities[riskLevel].map(a=>'<li>'+a+'</li>').join('')}</ul>
          </div>
          
          <div class="result-section">
            <h4>Regulatory Considerations</h4>
            <p>${gxp.includes('Yes')&&eSig==='Yes'?
              'This system requires compliance with <strong>FDA 21 CFR Part 11</strong> and <strong>EU Annex 11</strong>. Electronic signatures must be validated. Audit trails must be comprehensive and reviewed regularly.':
              'Standard GxP validation requirements apply. Follow GAMP 5 guidelines and ICH Q9 risk management principles.'}</p>
          </div>
          
          <div class="btn-group">
            <button class="btn" onclick="exportReport()"><span>üìÑ</span><span>Export Report</span></button>
            <button class="btn btn-secondary" onclick="showStep(1)"><span>‚Üª</span><span>Start New Assessment</span></button>
          </div>
        </div>
      `;
      
      // Remove existing results if any
      const existingResults = document.getElementById('resultsCard');
      if (existingResults) existingResults.remove();
      
      // Add new results
      document.querySelector('.container').insertAdjacentHTML('beforeend', resultsHTML);
      
      // Scroll to results
      setTimeout(() => {
        document.getElementById('resultsCard').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }
    
    function exportReport() {
      const system = document.getElementById('systemName').value || 'System';
      const timestamp = new Date().toLocaleString();
      
      const report = `RISK ASSESSMENT REPORT
========================================
System: ${system}
Date: ${timestamp}
Compliance Framework: GAMP 5, ICH Q9

RISK LEVEL: ${assessmentResult.riskLevel} (Score: ${assessmentResult.riskScore}/120)

VALIDATION STRATEGY:
${assessmentResult.strategy}

REQUIRED TEST ACTIVITIES:
${assessmentResult.activities.map((a,i)=>`${i+1}. ${a}`).join('\n')}

RECOMMENDATIONS:
- Follow risk-based validation approach
- Document all test activities thoroughly
- Ensure traceability to requirements
- Obtain QA approval before production use
- Regular review of validation status

Generated by ValQMS Tools
========================================`;
      
      const blob = new Blob([report], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Risk_Assessment_${system.replace(/\s/g,'_')}_${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    console.log('Script loaded successfully');
  </script>
</body>
</html>
