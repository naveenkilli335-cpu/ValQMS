<!DOCTYPE html>
<html lang="en" data-theme="green" data-bg="mesh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AI Validation Plan Generator — ValQMS</title>
  <link rel="icon" href="favicon.jpg?v=5">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    
    /* Theme Colors */
    [data-theme="green"]{--accent:#10b981;--accent-bright:#34d399;--accent-dim:rgba(16,185,129,0.15);--accent-glow:rgba(16,185,129,0.4)}
    [data-theme="cyan"]{--accent:#06b6d4;--accent-bright:#22d3ee;--accent-dim:rgba(6,182,212,0.15);--accent-glow:rgba(6,182,212,0.4)}
    [data-theme="purple"]{--accent:#8b5cf6;--accent-bright:#a78bfa;--accent-dim:rgba(139,92,246,0.15);--accent-glow:rgba(139,92,246,0.4)}
    [data-theme="orange"]{--accent:#f97316;--accent-bright:#fb923c;--accent-dim:rgba(249,115,22,0.15);--accent-glow:rgba(249,115,22,0.4)}
    [data-theme="blue"]{--accent:#3b82f6;--accent-bright:#60a5fa;--accent-dim:rgba(59,130,246,0.15);--accent-glow:rgba(59,130,246,0.4)}
    [data-theme="red"]{--accent:#ef4444;--accent-bright:#f87171;--accent-dim:rgba(239,68,68,0.15);--accent-glow:rgba(239,68,68,0.4)}
    [data-theme="pink"]{--accent:#ec4899;--accent-bright:#f472b6;--accent-dim:rgba(236,72,153,0.15);--accent-glow:rgba(236,72,153,0.4)}
    [data-theme="teal"]{--accent:#14b8a6;--accent-bright:#2dd4bf;--accent-dim:rgba(20,184,166,0.15);--accent-glow:rgba(20,184,166,0.4)}
    [data-theme="indigo"]{--accent:#6366f1;--accent-bright:#818cf8;--accent-dim:rgba(99,102,241,0.15);--accent-glow:rgba(99,102,241,0.4)}
    [data-theme="yellow"]{--accent:#eab308;--accent-bright:#facc15;--accent-dim:rgba(234,179,8,0.15);--accent-glow:rgba(234,179,8,0.4)}
    [data-theme="magenta"]{--accent:#d946ef;--accent-bright:#e879f9;--accent-dim:rgba(217,70,239,0.15);--accent-glow:rgba(217,70,239,0.4)}
    [data-theme="emerald"]{--accent:#059669;--accent-bright:#10b981;--accent-dim:rgba(5,150,105,0.15);--accent-glow:rgba(5,150,105,0.4)}
    [data-theme="amber"]{--accent:#d97706;--accent-bright:#f59e0b;--accent-dim:rgba(217,119,6,0.15);--accent-glow:rgba(217,119,6,0.4)}
    [data-theme="lime"]{--accent:#84cc16;--accent-bright:#a3e635;--accent-dim:rgba(132,204,22,0.15);--accent-glow:rgba(132,204,22,0.4)}
    [data-theme="violet"]{--accent:#7c3aed;--accent-bright:#a78bfa;--accent-dim:rgba(124,58,237,0.15);--accent-glow:rgba(124,58,237,0.4)}

    :root{
      --text:#ffffff;
      --text-dim:#94a3b8;
      --surface:rgba(255,255,255,0.05);
      --surface-hover:rgba(255,255,255,0.08);
      --border:rgba(255,255,255,0.1);
      --glass:rgba(255,255,255,0.03);
    }

    /* ANIMATED BACKGROUNDS */
    [data-bg="mesh"] body{background:#0f172a;position:relative}
    [data-bg="mesh"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%, rgba(16,185,129,0.15) 0%, transparent 50%),radial-gradient(circle at 80% 80%, rgba(99,102,241,0.15) 0%, transparent 50%),radial-gradient(circle at 40% 80%, rgba(236,72,153,0.1) 0%, transparent 50%);animation:meshMove 15s ease-in-out infinite alternate;z-index:-1}
    [data-bg="gradient"] body{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);position:relative}
    [data-bg="gradient"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg, transparent 0%, rgba(0,0,0,0.3) 100%);z-index:-1}
    [data-bg="dots"] body{background:#0a0e27;position:relative}
    [data-bg="dots"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(circle, rgba(255,255,255,0.05) 1px, transparent 1px);background-size:30px 30px;z-index:-1}
    [data-bg="waves"] body{background:#0f172a;position:relative}
    [data-bg="waves"] body::before{content:'';position:fixed;bottom:0;left:0;width:100%;height:400px;background:linear-gradient(180deg, transparent 0%, rgba(16,185,129,0.1) 100%);animation:waveMove 8s ease-in-out infinite;z-index:-1}
    [data-bg="dark"] body{background:#0a0e1a;position:relative}
    [data-bg="dark"] body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center, rgba(59,130,246,0.05) 0%, transparent 70%);z-index:-1}

    @keyframes meshMove{0%{transform:scale(1) rotate(0deg)}100%{transform:scale(1.1) rotate(5deg)}}
    @keyframes waveMove{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    
    html{scroll-behavior:smooth}
    body{
      font-family:'Inter',system-ui,-apple-system,sans-serif;
      color:var(--text);
      line-height:1.6;
      -webkit-font-smoothing:antialiased;
      transition:background 0.5s ease;
      min-height:100vh;
      overflow-x:hidden;
      padding-bottom:40px;
    }

    /* GLASSMORPHISM HEADER */
    header{
      position:sticky;
      top:12px;
      z-index:100;
      padding:0 24px;
      margin-bottom:40px;
    }
    .header-glass{
      background:rgba(255,255,255,0.03);
      backdrop-filter:blur(20px) saturate(180%);
      -webkit-backdrop-filter:blur(20px) saturate(180%);
      border:1px solid rgba(255,255,255,0.1);
      border-radius:20px;
      padding:16px 32px;
      box-shadow:0 8px 32px rgba(0,0,0,0.1),inset 0 1px 0 rgba(255,255,255,0.1);
    }
    header .header-container{
      display:flex;
      justify-content:space-between;
      align-items:center;
      max-width:1400px;
      margin:0 auto;
    }
    .logo{
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:var(--text);
      font-weight:800;
      font-size:22px;
      letter-spacing:-0.7px;
      transition:all 0.3s;
    }
    .logo:hover{transform:translateY(-2px)}
    .logo-mark{
      display:flex;
      align-items:center;
      justify-content:center;
      width:48px;
      height:48px;
      background:linear-gradient(135deg,var(--accent),var(--accent-bright));
      border-radius:12px;
      box-shadow:0 4px 20px var(--accent-glow);
      transition:all 0.3s;
      position:relative;
    }
    .logo-mark::after{
      content:'';
      position:absolute;
      inset:-2px;
      background:linear-gradient(135deg,var(--accent),var(--accent-bright));
      border-radius:14px;
      z-index:-1;
      opacity:0;
      filter:blur(10px);
      transition:opacity 0.3s;
    }
    .logo-mark:hover::after{opacity:0.7}
    .logo-mark img{width:100%;height:100%;object-fit:contain;padding:6px}
    .brand-text{display:flex;flex-direction:column;gap:2px}
    .brand-text h1{font-size:20px;font-weight:800;letter-spacing:-0.5px;margin:0;line-height:1.2;color:var(--text)}
    .brand-text .subtitle{font-size:13px;color:var(--text-dim);font-weight:500;line-height:1.2}

    .header-controls{display:flex;gap:12px;align-items:center}
    .bg-selector,.theme-selector{position:relative}
    .bg-btn,.theme-btn{
      padding:10px 18px;background:var(--surface);border:1px solid var(--border);border-radius:12px;color:var(--text-dim);
      font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.3s;
    }
    .bg-btn:hover,.theme-btn:hover{background:var(--surface-hover);border-color:var(--accent);color:var(--text)}
    .bg-dropdown,.theme-dropdown{
      position:absolute;top:calc(100% + 12px);right:0;background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);
      border:1px solid var(--border);border-radius:16px;padding:12px;display:none;min-width:200px;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:200;
    }
    .bg-dropdown.active,.theme-dropdown.active{display:block}
    .bg-option,.theme-option{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;cursor:pointer;transition:all 0.3s;font-size:14px;font-weight:500}
    .bg-option:hover,.theme-option:hover{background:var(--surface-hover)}
    .bg-preview{width:32px;height:32px;border-radius:8px;border:2px solid rgba(255,255,255,0.2)}
    .bg-preview.mesh{background:radial-gradient(circle, #10b981 0%, #6366f1 100%)}
    .bg-preview.gradient{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%)}
    .bg-preview.dots{background:#0a0e27;background-image:radial-gradient(circle, rgba(255,255,255,0.2) 1px, transparent 1px);background-size:15px 15px}
    .bg-preview.waves{background:linear-gradient(180deg, #0f172a 0%, #10b981 100%)}
    .bg-preview.dark{background:#0a0e1a}
    .theme-dropdown{max-height:400px;overflow-y:auto}
    .theme-dropdown::-webkit-scrollbar{width:6px}
    .theme-dropdown::-webkit-scrollbar-thumb{background:var(--accent);border-radius:10px}
    .theme-color{width:28px;height:28px;border-radius:8px;border:2px solid rgba(255,255,255,0.2);transition:all 0.3s}
    .theme-option:hover .theme-color{transform:scale(1.1)}
    .theme-color.green{background:linear-gradient(135deg,#10b981,#34d399)}
    .theme-color.cyan{background:linear-gradient(135deg,#06b6d4,#22d3ee)}
    .theme-color.purple{background:linear-gradient(135deg,#8b5cf6,#a78bfa)}
    .theme-color.orange{background:linear-gradient(135deg,#f97316,#fb923c)}
    .theme-color.blue{background:linear-gradient(135deg,#3b82f6,#60a5fa)}
    .theme-color.red{background:linear-gradient(135deg,#ef4444,#f87171)}
    .theme-color.pink{background:linear-gradient(135deg,#ec4899,#f472b6)}
    .theme-color.teal{background:linear-gradient(135deg,#14b8a6,#2dd4bf)}
    .theme-color.indigo{background:linear-gradient(135deg,#6366f1,#818cf8)}
    .theme-color.yellow{background:linear-gradient(135deg,#eab308,#facc15)}
    .theme-color.magenta{background:linear-gradient(135deg,#d946ef,#e879f9)}
    .theme-color.emerald{background:linear-gradient(135deg,#059669,#10b981)}
    .theme-color.amber{background:linear-gradient(135deg,#d97706,#f59e0b)}
    .theme-color.lime{background:linear-gradient(135deg,#84cc16,#a3e635)}
    .theme-color.violet{background:linear-gradient(135deg,#7c3aed,#a78bfa)}
    .btn-home{padding:10px 20px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));border:none;border-radius:12px;color:#000;font-size:14px;font-weight:700;text-decoration:none;transition:all 0.3s;display:inline-flex;align-items:center;gap:8px;box-shadow:0 4px 16px var(--accent-glow)}
    .btn-home:hover{transform:translateY(-2px);box-shadow:0 8px 24px var(--accent-glow)}

    .container{max-width:1400px;margin:0 auto;padding:0 24px;position:relative;z-index:1}
    .card{background:var(--glass);backdrop-filter:blur(10px);padding:28px;border-radius:18px;border:1px solid var(--border);margin-bottom:20px;transition:all 0.3s}
    .card:hover{border-color:var(--accent);box-shadow:0 8px 24px rgba(0,0,0,0.2)}
    .card h3{font-size:18px;font-weight:700;margin:0 0 16px 0;letter-spacing:-0.3px}

    .how-to-use{background:var(--glass);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:18px;padding:24px 28px;margin-bottom:24px;transition:all 0.3s}
    .how-to-use:hover{border-color:var(--accent)}
    .how-to-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;user-select:none}
    .how-to-header h3{font-size:18px;font-weight:700;margin:0;color:var(--text);letter-spacing:-0.3px}
    .toggle-icon{font-size:16px;transition:transform 0.3s;color:var(--accent)}
    .toggle-icon.collapsed{transform:rotate(-90deg)}
    .how-to-content{overflow:hidden;transition:max-height 0.3s ease, opacity 0.3s ease, margin-top 0.3s ease;opacity:1;margin-top:16px}
    .how-to-content.hidden{opacity:0;margin-top:0}
    .how-to-content ol{margin:0 0 0 24px;color:var(--text-dim);font-size:14px;line-height:2;font-weight:300}
    .how-to-content li{margin-bottom:8px}
    .how-to-content strong{color:var(--text);font-weight:600}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
    .field{margin-bottom:16px}
    label{display:block;font-size:13px;color:var(--text-dim);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
    input[type=text],textarea,select{width:100%;padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:var(--surface);color:#ffffff !important;font-size:14px;transition:all 0.3s;font-family:inherit}
    input:hover,textarea:hover,select:hover{border-color:var(--accent)}
    input:focus,textarea:focus,select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-dim)}
    select option{background:#1a1f2e !important;color:#ffffff !important;padding:10px}
    textarea{min-height:120px;resize:vertical;font-family:inherit}

    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;background:linear-gradient(135deg,var(--accent),var(--accent-bright));color:#000;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 16px var(--accent-glow)}
    .btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px var(--accent-glow)}
    .btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    .btn.secondary{background:var(--surface);border:1px solid var(--border);color:var(--text);box-shadow:none}
    .btn.secondary:hover{background:var(--surface-hover);border-color:var(--accent)}

    .actions{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}

    pre{white-space:pre-wrap;font-family:'SF Mono','Monaco','Courier New',monospace;font-size:13px;color:var(--text);background:rgba(0,0,0,0.4);backdrop-filter:blur(10px);padding:24px;border-radius:12px;max-height:600px;overflow:auto;border:1px solid var(--border);line-height:1.8}
    pre::-webkit-scrollbar{width:10px} pre::-webkit-scrollbar-track{background:transparent} pre::-webkit-scrollbar-thumb{background:var(--accent);border-radius:10px}

    .meta{font-size:12px;color:var(--text-dim);margin-top:16px;padding-top:16px;border-top:1px solid var(--border);font-weight:300}
    .hint{font-size:13px;color:var(--text-dim);margin-top:16px;padding:16px;background:var(--accent-dim);border-radius:10px;border-left:4px solid var(--accent);font-weight:300;line-height:1.8}
    .hint strong{color:var(--text);font-weight:600}

    /* Safety: prevent any stray nodes outside app root from showing */
    body > :not(#app-root):not(script):not(link):not(style){display:none !important}

    @media(max-width:968px){
      header{top:8px;padding:0 16px}
      .header-glass{padding:12px 20px;border-radius:16px}
      .brand-text h1{font-size:16px}
      .brand-text .subtitle{font-size:11px}
      .logo-mark{width:40px;height:40px}
      .header-controls{gap:8px}
      .bg-btn,.theme-btn{padding:10px;font-size:0}
      .bg-btn span:last-child,.theme-btn span:last-child{display:none}
      .btn-home span:first-child{display:none}
      .grid{grid-template-columns:1fr}
    }

    ::-webkit-scrollbar{width:10px;height:10px}
    ::-webkit-scrollbar-track{background:transparent;border-radius:10px}
    ::-webkit-scrollbar-thumb{background:var(--accent);border-radius:10px}
  </style>
</head>
<body>

  <div id="app-root">
    <!-- GLASSMORPHISM HEADER -->
    <header>
      <div class="header-glass">
        <div class="header-container">
          <a href="index.html" class="logo">
            <div class="logo-mark"><img src="favicon.jpg" alt="ValQMS"></div>
            <div class="brand-text">
              <h1>ValQMS Tools</h1>
              <div class="subtitle">AI Validation Plan Generator</div>
            </div>
          </a>

          <div class="header-controls">
            <!-- Background Selector -->
            <div class="bg-selector">
              <button class="bg-btn" id="bgBtn"><span>🎨</span><span>Background</span></button>
              <div class="bg-dropdown" id="bgDropdown">
                <div class="bg-option" data-bg="mesh"><div class="bg-preview mesh"></div><span>Mesh Gradient</span></div>
                <div class="bg-option" data-bg="gradient"><div class="bg-preview gradient"></div><span>Purple Gradient</span></div>
                <div class="bg-option" data-bg="dots"><div class="bg-preview dots"></div><span>Dot Pattern</span></div>
                <div class="bg-option" data-bg="waves"><div class="bg-preview waves"></div><span>Wave Motion</span></div>
                <div class="bg-option" data-bg="dark"><div class="bg-preview dark"></div><span>Dark Mode</span></div>
              </div>
            </div>

            <!-- Theme Selector -->
            <div class="theme-selector">
              <button class="theme-btn" id="themeBtn"><span>🎨</span><span>Theme</span></button>
              <div class="theme-dropdown" id="themeDropdown">
                <div class="theme-option" data-theme="green"><div class="theme-color green"></div><span>Green</span></div>
                <div class="theme-option" data-theme="cyan"><div class="theme-color cyan"></div><span>Cyan</span></div>
                <div class="theme-option" data-theme="purple"><div class="theme-color purple"></div><span>Purple</span></div>
                <div class="theme-option" data-theme="orange"><div class="theme-color orange"></div><span>Orange</span></div>
                <div class="theme-option" data-theme="blue"><div class="theme-color blue"></div><span>Blue</span></div>
                <div class="theme-option" data-theme="red"><div class="theme-color red"></div><span>Red</span></div>
                <div class="theme-option" data-theme="pink"><div class="theme-color pink"></div><span>Pink</span></div>
                <div class="theme-option" data-theme="teal"><div class="theme-color teal"></div><span>Teal</span></div>
                <div class="theme-option" data-theme="indigo"><div class="theme-color indigo"></div><span>Indigo</span></div>
                <div class="theme-option" data-theme="yellow"><div class="theme-color yellow"></div><span>Yellow</span></div>
                <div class="theme-option" data-theme="magenta"><div class="theme-color magenta"></div><span>Magenta</span></div>
                <div class="theme-option" data-theme="emerald"><div class="theme-color emerald"></div><span>Emerald</span></div>
                <div class="theme-option" data-theme="amber"><div class="theme-color amber"></div><span>Amber</span></div>
                <div class="theme-option" data-theme="lime"><div class="theme-color lime"></div><span>Lime</span></div>
                <div class="theme-option" data-theme="violet"><div class="theme-color violet"></div><span>Violet</span></div>
              </div>
            </div>

            <a href="index.html" class="btn-home"><span>←</span><span>Home</span></a>
          </div>
        </div>
      </div>
    </header>

    <div class="container">
      <div class="how-to-use">
        <div class="how-to-header" id="howToToggle">
          <h3>📖 How to Use</h3>
          <span class="toggle-icon" id="toggleIcon">▼</span>
        </div>
        <div class="how-to-content" id="howToContent">
          <ol>
            <li>Fill the form fields describing your system, scope, and validation requirements</li>
            <li>Click <strong>Generate Plan</strong> to create a comprehensive validation plan using AI</li>
            <li>Review the generated plan in the output section</li>
            <li>Use <strong>Copy</strong> to copy text or <strong>Download .docx</strong> to save as Word document</li>
            <li><strong>Note:</strong> Requires API key configuration for production use</li>
          </ol>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>Validation Details</h3>

          <div class="field">
            <label for="title">Validation Plan Title</label>
            <input id="title" type="text" placeholder="Validation of LIMS v2.1 - Instrument Integration" value="Validation of [System Name]">
          </div>

          <div class="field">
            <label for="system">System / Application Name</label>
            <input id="system" type="text" placeholder="System name, e.g. LabWare LIMS" value="LabWare LIMS">
          </div>

          <div class="field">
            <label for="scope">Scope (brief)</label>
            <textarea id="scope" placeholder="Describe in 1-2 sentences what is in/out of scope">This validation covers the installation, operation, and performance qualification of the LIMS integration for sample management and reporting.</textarea>
          </div>

          <div class="field">
            <label for="objectives">Validation Objectives</label>
            <textarea id="objectives" placeholder="List key objectives separated by semicolons">Ensure system meets functional and regulatory requirements; Demonstrate data integrity; Verify access controls and audit trails</textarea>
          </div>

          <div class="field">
            <label for="env">Environments</label>
            <input id="env" type="text" placeholder="e.g., Dev / Test / Prod" value="IQ, OQ, PQ">
          </div>

          <div class="field">
            <label for="regulatory">Regulatory References</label>
            <input id="regulatory" type="text" value="FDA 21 CFR Part 11, EU Annex 11, GAMP 5, ICH Q9">
          </div>

          <div class="field">
            <label for="risk">Risk Level</label>
            <select id="risk">
              <option>Low</option>
              <option selected>Medium</option>
              <option>High</option>
            </select>
          </div>

          <div class="field">
            <label for="testscope">Suggested Test Scope</label>
            <textarea id="testscope" placeholder="Main tests to include">Functional tests, Security (authentication/authorization), Data integrity checks, Backup/restore, Performance under expected load</textarea>
          </div>

          <div class="field">
            <label for="assurance">Acceptance Criteria</label>
            <textarea id="assurance">All critical test cases pass; No open critical deviations; Audit trails record required events</textarea>
          </div>

          <div class="field">
            <label for="additional">Additional Notes / Special Requirements</label>
            <textarea id="additional">Include traceability matrix mapping between requirements and test cases. Include CSV/CSA considerations if applicable.</textarea>
          </div>

          <div class="actions">
            <button id="generate" class="btn"><span>🤖</span><span>Generate Plan</span></button>
            <button id="clear" class="btn secondary">Clear</button>
          </div>

          <div class="hint">
            <strong>⚠️ API Configuration Required:</strong> This tool requires a valid OpenAI-compatible API key. For production use, implement a server-side proxy to protect your API credentials.
          </div>
        </div>

        <div class="card">
          <h3>Generated Validation Plan</h3>
          <pre id="output">No plan generated yet. Click "Generate Plan" to produce content.</pre>
          <div class="actions">
            <button id="copy" class="btn secondary">📋 Copy</button>
            <button id="download" class="btn">⬇️ Download .docx</button>
          </div>
          <div class="meta">
            <strong>Model:</strong> GPT-4 (configurable)<br>
            <strong>Security:</strong> Move API calls to server-side for production
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Word export template to avoid inline-HTML string issues -->
  <template id="word-template">
<!DOCTYPE html>
<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word">
<head>
  <meta charset="utf-8">
  <title></title>
  <style>
    body { font-family: Calibri, Arial, sans-serif; font-size: 11pt; line-height: 1.6; margin: 1in; }
    h1 { font-size: 18pt; font-weight: bold; color: #10b981; border-bottom: 2px solid #10b981; padding-bottom: 8pt; margin-bottom: 12pt; }
    pre { font-family: "Courier New", monospace; font-size: 10pt; white-space: pre-wrap; background-color: #f5f5f5; padding: 12pt; border: 1px solid #ddd; border-radius: 4pt; }
  </style>
</head>
<body>
  <h1 id="doc-title"></h1>
  <pre id="doc-body"></pre>
</body>
</html>
  </template>

  <script>
    // Theme & Background System
    const themeBtn=document.getElementById('themeBtn');
    const themeDropdown=document.getElementById('themeDropdown');
    const themeOptions=document.querySelectorAll('.theme-option');
    const bgBtn=document.getElementById('bgBtn');
    const bgDropdown=document.getElementById('bgDropdown');
    const bgOptions=document.querySelectorAll('.bg-option');

    themeBtn?.addEventListener('click',e=>{e.stopPropagation();themeDropdown.classList.toggle('active');bgDropdown.classList.remove('active')});
    bgBtn?.addEventListener('click',e=>{e.stopPropagation();bgDropdown.classList.toggle('active');themeDropdown.classList.remove('active')});
    document.addEventListener('click',()=>{themeDropdown.classList.remove('active');bgDropdown.classList.remove('active')});
    themeDropdown?.addEventListener('click',e=>e.stopPropagation());
    bgDropdown?.addEventListener('click',e=>e.stopPropagation());

    themeOptions.forEach(opt=>{
      opt.addEventListener('click',()=>{
        const theme=opt.dataset.theme;
        document.documentElement.setAttribute('data-theme',theme);
        localStorage.setItem('valqmsTheme',theme);
        themeDropdown.classList.remove('active');
      });
    });

    bgOptions.forEach(opt=>{
      opt.addEventListener('click',()=>{
        const bg=opt.dataset.bg;
        document.documentElement.setAttribute('data-bg',bg);
        localStorage.setItem('valqmsBg',bg);
        bgDropdown.classList.remove('active');
      });
    });

    function initTheme(){
      const savedTheme=localStorage.getItem('valqmsTheme')||'green';
      const savedBg=localStorage.getItem('valqmsBg')||'mesh';
      document.documentElement.setAttribute('data-theme',savedTheme);
      document.documentElement.setAttribute('data-bg',savedBg);
    }
    initTheme();

    // HOW TO USE TOGGLE (robust)
    const howToToggle = document.getElementById('howToToggle');
    const howToContent = document.getElementById('howToContent');
    const toggleIcon = document.getElementById('toggleIcon');

    function expandHowTo() {
      howToContent.classList.remove('hidden');
      howToContent.style.maxHeight = 'none';
      const h = howToContent.scrollHeight + 'px';
      howToContent.style.maxHeight = '0px';
      requestAnimationFrame(()=>{ howToContent.style.maxHeight = h; });
      toggleIcon.classList.remove('collapsed');
    }
    function collapseHowTo() {
      howToContent.style.maxHeight = howToContent.scrollHeight + 'px';
      requestAnimationFrame(()=>{ howToContent.style.maxHeight = '0px'; howToContent.classList.add('hidden'); });
      toggleIcon.classList.add('collapsed');
    }
    const howToVisible = localStorage.getItem('howToVisible') !== 'false';
    if (howToVisible) {
      howToContent.classList.remove('hidden');
      howToContent.style.maxHeight = howToContent.scrollHeight + 'px';
      toggleIcon.classList.remove('collapsed');
    } else {
      howToContent.classList.add('hidden');
      howToContent.style.maxHeight = '0px';
      toggleIcon.classList.add('collapsed');
    }
    howToToggle.addEventListener('click', () => {
      const isHidden = howToContent.classList.contains('hidden');
      if (isHidden) expandHowTo(); else collapseHowTo();
      localStorage.setItem('howToVisible', isHidden ? 'true' : 'false');
    });

    // Helper
    function escapeHtml(s){ if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'); }

    // AI CONFIGURATION (placeholder)
    const SERVER_PROXY=''; const DIRECT_OPENAI=false; const API_KEY='YOUR_API_KEY'; const MODEL='gpt-4';

    const el = id => document.getElementById(id);
    const output = el('output');
    const generateBtn = el('generate');
    const copyBtn = el('copy');
    const downloadBtn = el('download');
    const clearBtn = el('clear');

    function buildPrompt(){
      const title=el('title').value.trim();
      const system=el('system').value.trim();
      const scope=el('scope').value.trim();
      const objectives=el('objectives').value.trim();
      const env=el('env').value.trim();
      const regulatory=el('regulatory').value.trim();
      const risk=el('risk').value;
      const testscope=el('testscope').value.trim();
      const assurance=el('assurance').value.trim();
      const additional=el('additional').value.trim();
      return `You are an expert validation engineer specialized in regulated life-sciences systems (CSV/CSA). Using the information below, generate a clear, audit-ready Validation Plan with sections and numbered headings. Include brief text for each section and a suggested table of contents. Ensure the plan references appropriate regulations and gives concrete test deliverables.

Output must include: 
- Title
- Version & Document Control
- Table of Contents
- 1. Scope
- 2. Purpose & Objectives
- 3. System Description
- 4. Roles and Responsibilities
- 5. Validation Strategy
- 6. Requirements Traceability Matrix (describe columns)
- 7. Test Strategy (IQ/OQ/PQ and sample test cases)
- 8. Acceptance Criteria
- 9. Risk Assessment Summary
- 10. Deliverables
- 11. Schedule & Milestones
- 12. Approval and Sign-off

Input data:
- Validation Plan Title: ${title}
- System/Application: ${system}
- Scope: ${scope}
- Objectives: ${objectives}
- Environments: ${env}
- Regulatory References: ${regulatory}
- Risk Level: ${risk}
- Test Scope: ${testscope}
- Acceptance Criteria: ${assurance}
- Additional Notes: ${additional}

Write in professional, concise language appropriate for auditors and quality teams. For the Test Strategy include 6-8 example test cases mapping to requirements (show steps and expected results). For the Traceability Matrix, describe the columns and give 6 example rows mapping requirements -> test cases -> results -> evidence. Also include a short 3-bullet executive summary at the top and a short paragraph with implementation considerations. Do not add imaginary company-specific references; keep it generic but practical.`;
    }

    async function callAI(prompt){
      const body={model:MODEL,messages:[{role:'system',content:'You are a helpful validation plan author for regulated industries.'},{role:'user',content:prompt}],temperature:0.2,max_tokens:2000};
      let respJson;
      if (SERVER_PROXY){
        const resp=await fetch(SERVER_PROXY,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
        respJson=await resp.json();
      } else if (DIRECT_OPENAI){
        const resp=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+API_KEY},body:JSON.stringify(body)});
        respJson=await resp.json();
      } else {
        throw new Error('No SERVER_PROXY configured. Set SERVER_PROXY or enable DIRECT_OPENAI for local testing.');
      }
      return respJson?.choices?.[0]?.message?.content || respJson?.choices?.[0]?.text || JSON.stringify(respJson);
    }

    generateBtn.addEventListener('click', async ()=>{
      generateBtn.disabled=true; generateBtn.innerHTML='<span>⏳</span><span>Generating...</span>'; output.textContent='Working...';
      try{ const prompt=buildPrompt(); const result=await callAI(prompt); output.textContent=result; }
      catch(err){ output.textContent='Error generating plan: '+(err.message||err); }
      finally{ generateBtn.disabled=false; generateBtn.innerHTML='<span>🤖</span><span>Generate Plan</span>'; }
    });

    copyBtn.addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(output.textContent); copyBtn.textContent='✓ Copied'; setTimeout(()=>copyBtn.textContent='📋 Copy',1500); }
      catch(e){ alert('Copy failed: '+e); }
    });

    clearBtn.addEventListener('click', ()=>{
      el('title').value='Validation of [System Name]';
      el('system').value='LabWare LIMS';
      el('scope').value='This validation covers the installation, operation, and performance qualification of the LIMS integration for sample management and reporting.';
      el('objectives').value='Ensure system meets functional and regulatory requirements; Demonstrate data integrity; Verify access controls and audit trails';
      el('env').value='IQ, OQ, PQ';
      el('regulatory').value='FDA 21 CFR Part 11, EU Annex 11, GAMP 5, ICH Q9';
      el('risk').value='Medium';
      el('testscope').value='Functional tests, Security (authentication/authorization), Data integrity checks, Backup/restore, Performance under expected load';
      el('assurance').value='All critical test cases pass; No open critical deviations; Audit trails record required events';
      el('additional').value='Include traceability matrix mapping between requirements and test cases. Include CSV/CSA considerations if applicable.';
      output.textContent='No plan generated yet. Click "Generate Plan" to produce content.';
    });

    // Safe Word export using template
    function createWordBlob(title, content){
      const tpl=document.getElementById('word-template');
      const doc=tpl.content.cloneNode(true);
      doc.getElementById('doc-title').textContent=title;
      doc.getElementById('doc-body').textContent=content;
      const s=new XMLSerializer();
      const html='<!DOCTYPE html>\n'+s.serializeToString(doc);
      return new Blob([html],{type:'application/msword'});
    }

    downloadBtn.addEventListener('click', ()=>{
      const titleValue=el('title').value.trim()||'Validation_Plan';
      const outputText=output.textContent;
      if (!outputText || outputText.startsWith('No plan') || outputText==='Working...'){
        alert('Please generate a plan first before downloading.');
        return;
      }
      const blob=createWordBlob(titleValue, outputText);
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url;
      a.download=titleValue.replace(/[^a-zA-Z0-9\-_]/g,'_')+'.doc';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
